openapi: 3.0.3
info:
  title: Retech Core API
  version: 1.0.0
  description: |
    # üöÄ Retech Core API
    
    A API definitiva de dados brasileiros para desenvolvedores.
    
    ## üéØ Caracter√≠sticas
    
    - ‚ö° **Performance**: Respostas em <100ms
    - üîí **Seguran√ßa**: API Key + Rate Limiting
    - üìä **Dados**: Geografia, CEP, CNPJ, CPF e mais
    - üéÅ **Gratuito**: 1.000 requests/dia no plano Free
    
    ## üîê Autentica√ß√£o
    
    Use o header `X-API-Key` com sua chave de API:
    
    ```bash
    curl __API_BASE_URL__/geo/ufs \
      -H "X-API-Key: sua_api_key_aqui"
    ```
    
    ## üìà Rate Limiting
    
    - **Plano Free**: 1.000 requests/dia, 60/min
    - **Plano Pro**: 10.000 requests/dia, 200/min
    - **Plano Business**: Custom
    
    ## üìö Mais Informa√ß√µes
    
    - **Portal do Desenvolvedor**: https://core.theretech.com.br
    - **Documenta√ß√£o Completa**: https://core.theretech.com.br/painel/docs
    - **Status**: https://status.theretech.com.br
    
  contact:
    name: Retech Support
    email: suporte@theretech.com.br
    url: https://core.theretech.com.br
  license:
    name: Proprietary
    url: https://core.theretech.com.br/termos

servers:
  - url: __API_BASE_URL__

tags:
  - name: Infraestrutura
    description: Health checks e informa√ß√µes do sistema
  - name: CEP
    description: Consulta de CEP com cache e m√∫ltiplas fontes
  - name: CNPJ
    description: Consulta de CNPJ com dados da Receita Federal
  - name: Geografia
    description: Estados, munic√≠pios e dados geogr√°ficos do Brasil
  - name: Artigos Penais
    description: Artigos penais brasileiros (Codigo Penal + legislacoes especiais)

paths:
  # ==========================================
  # INFRAESTRUTURA
  # ==========================================
  /health:
    get:
      tags: [Infraestrutura]
      summary: Health Check
      description: Verifica se a API est√° funcionando
      responses:
        '200':
          description: API funcionando normalmente
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"

  /version:
    get:
      tags: [Infraestrutura]
      summary: Vers√£o da API
      description: Retorna informa√ß√µes sobre a vers√£o atual
      responses:
        '200':
          description: Informa√ß√µes da vers√£o
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                    example: "1.0.0"
                  environment:
                    type: string
                    example: "production"

  # ==========================================
  # CEP
  # ==========================================
  /cep/{codigo}:
    get:
      tags: [CEP]
      summary: Consultar CEP
      description: |
        Consulta um CEP brasileiro. 
        
        **Fontes de Dados:**
        - ü•á **ViaCEP** (principal)
        - ü•à **Brasil API** (fallback)
        - üíæ **Cache** (7 dias)
        
        **Performance:**
        - Cache: < 10ms
        - ViaCEP: ~50ms
        - Brasil API: ~100ms
        
        **Formato aceito:**
        - Com tra√ßo: `01310-100`
        - Sem tra√ßo: `01310100`
        
      security:
        - ApiKeyAuth: []
      parameters:
        - name: codigo
          in: path
          required: true
          description: "CEP brasileiro (com ou sem tra√ßo)"
          schema:
            type: string
            example: "01310-100"
      responses:
        '200':
          description: CEP encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CEP'
              examples:
                avenida_paulista:
                  summary: "Av. Paulista - S√£o Paulo"
                  value:
                    cep: "01310-100"
                    logradouro: "Avenida Paulista"
                    complemento: "de 612 a 1510 - lado par"
                    bairro: "Bela Vista"
                    localidade: "S√£o Paulo"
                    uf: "SP"
                    ibge: "3550308"
                    ddd: "11"
                    source: "viacep"
                    cachedAt: "2025-10-23T15:30:00Z"
                copacabana:
                  summary: "Copacabana - Rio de Janeiro"
                  value:
                    cep: "22021-001"
                    logradouro: "Avenida Atl√¢ntica"
                    bairro: "Copacabana"
                    localidade: "Rio de Janeiro"
                    uf: "RJ"
                    ibge: "3304557"
                    ddd: "21"
                    source: "cache"
                    cachedAt: "2025-10-20T10:15:00Z"
        '400':
          description: CEP inv√°lido
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                type: "https://retech-core/errors/validation"
                title: "Invalid CEP"
                status: 400
                detail: "CEP deve ter 8 d√≠gitos"
        '404':
          description: CEP n√£o encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                type: "https://retech-core/errors/not-found"
                title: "CEP Not Found"
                status: 404
                detail: "CEP 99999999 n√£o encontrado"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '503':
          $ref: '#/components/responses/Maintenance'

  /cep/buscar:
    get:
      tags: [CEP]
      summary: Buscar CEP por Endere√ßo (Busca Reversa)
      description: |
        üÜï **Busca reversa de CEP**: encontra CEPs a partir do endere√ßo.
        
        Digite a rua, cidade e estado para descobrir at√© **50 CEPs** correspondentes.
        
        **Fontes de Dados:**
        - ü•á **ViaCEP** (busca por endere√ßo)
        - üíæ **Cache** (7 dias)
        
        **Performance:**
        - Cache: ~1-10ms
        - ViaCEP: ~100-200ms
        
        **Valida√ß√µes:**
        - ‚úÖ UF deve ter 2 caracteres (ex: SP, RJ)
        - ‚úÖ Cidade deve ter no m√≠nimo 3 caracteres
        - ‚úÖ Logradouro deve ter no m√≠nimo 3 caracteres
        
        **Limita√ß√µes:**
        - üìã Retorna at√© 50 CEPs por busca
        - üîç Quanto mais espec√≠fico, melhor o resultado
        - üìù Busca por aproxima√ß√£o de nome
        
        **Exemplos de uso:**
        ```bash
        # Com acentos (recomendado - mais preciso)
        curl "__API_BASE_URL__/cep/buscar?uf=SP&cidade=S√£o+Paulo&logradouro=Paulista" \
          -H "X-API-Key: sua_api_key_aqui"
        
        # Sem acentos (funciona, mas menos preciso)
        curl "__API_BASE_URL__/cep/buscar?uf=SP&cidade=Sao+Paulo&logradouro=Paulista" \
          -H "X-API-Key: sua_api_key_aqui"
        
        # URL encoded (tamb√©m funciona)
        curl "__API_BASE_URL__/cep/buscar?uf=RS&cidade=Porto%20Alegre&logradouro=Andradas" \
          -H "X-API-Key: sua_api_key_aqui"
        ```
        
        **üìù Dicas de Formata√ß√£o:**
        - ‚úÖ **Acentos:** Pode enviar com acentos! A API normaliza automaticamente.
        - ‚úÖ **Espa√ßos:** Use `+` ou `%20` (ambos funcionam)
        - ‚úÖ **Case:** Mai√∫sculas/min√∫sculas n√£o importam (exceto UF que deve ser MAI√öSCULO)
        - ‚ö° **Encoding:** Feito automaticamente pelo backend
        
        **Casos de uso:**
        - üìù Autocomplete de endere√ßos
        - ‚úÖ Valida√ß√£o de formul√°rios
        - üîÑ Preenchimento autom√°tico de CEP
        - üîç Busca quando usu√°rio n√£o sabe o CEP
        
      security:
        - ApiKeyAuth: []
      parameters:
        - name: uf
          in: query
          required: true
          description: "Sigla do estado (2 caracteres)"
          schema:
            type: string
            minLength: 2
            maxLength: 2
            example: "SP"
        - name: cidade
          in: query
          required: true
          description: |
            Nome da cidade (m√≠nimo 3 caracteres)
            
            **‚úÖ Aceita acentos:** "S√£o Paulo", "Jo√£o Pessoa", "Bras√≠lia"
            
            **Encoding:** A API faz URL encoding automaticamente. Voc√™ pode enviar:
            - Com acentos: `cidade=S√£o Paulo` (recomendado)
            - Sem acentos: `cidade=Sao Paulo` (funciona, mas menos preciso)
            - URL encoded: `cidade=S%C3%A3o%20Paulo` (tamb√©m funciona)
          schema:
            type: string
            minLength: 3
            example: "S√£o Paulo"
        - name: logradouro
          in: query
          required: true
          description: |
            Nome da rua/avenida (m√≠nimo 3 caracteres)
            
            **‚úÖ Aceita acentos:** "Jo√£o Pessoa", "S√£o Jos√©", "Crist√≥v√£o"
            
            **Dica:** Quanto mais espec√≠fico, melhor o resultado.
            - ‚úÖ Bom: "Paulista"
            - ‚úÖ Melhor: "Avenida Paulista"
            - ‚ùå Muito gen√©rico: "Rua" (pode retornar muitos resultados)
          schema:
            type: string
            minLength: 3
            example: "Paulista"
      responses:
        '200':
          description: CEPs encontrados
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/CEP'
                    description: Lista de CEPs encontrados (at√© 50)
                  count:
                    type: integer
                    description: N√∫mero de resultados retornados
                    example: 12
                  source:
                    type: string
                    description: Fonte dos dados
                    enum: [viacep, redis-cache, mongodb-cache]
                    example: "viacep"
              examples:
                paulista_sp:
                  summary: "Avenida Paulista - S√£o Paulo/SP"
                  value:
                    results:
                      - cep: "01310100"
                        logradouro: "Avenida Paulista"
                        complemento: "de 612 a 1510 - lado par"
                        bairro: "Bela Vista"
                        localidade: "S√£o Paulo"
                        uf: "SP"
                        ibge: "3550308"
                        ddd: "11"
                        source: "viacep"
                      - cep: "01311000"
                        logradouro: "Avenida Paulista"
                        complemento: "de 1865 a 2265 - lado √≠mpar"
                        bairro: "Bela Vista"
                        localidade: "S√£o Paulo"
                        uf: "SP"
                        ibge: "3550308"
                        ddd: "11"
                        source: "viacep"
                      - cep: "01311100"
                        logradouro: "Avenida Paulista"
                        complemento: "de 1537 a 1863 - lado √≠mpar"
                        bairro: "Bela Vista"
                        localidade: "S√£o Paulo"
                        uf: "SP"
                        ibge: "3550308"
                        ddd: "11"
                        source: "viacep"
                    count: 3
                    source: "viacep"
                from_cache:
                  summary: "Resultado do cache (r√°pido)"
                  value:
                    results:
                      - cep: "90010150"
                        logradouro: "Rua dos Andradas"
                        bairro: "Centro Hist√≥rico"
                        localidade: "Porto Alegre"
                        uf: "RS"
                        ibge: "4314902"
                        ddd: "51"
                        source: "redis-cache"
                    count: 1
                    source: "redis-cache"
        '400':
          description: Par√¢metros inv√°lidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_params:
                  summary: "Par√¢metros obrigat√≥rios ausentes"
                  value:
                    type: "https://retech-core/errors/validation"
                    title: "Invalid Parameters"
                    status: 400
                    detail: "Par√¢metros obrigat√≥rios: uf, cidade, logradouro"
                min_length:
                  summary: "Tamanho m√≠nimo n√£o atingido"
                  value:
                    type: "https://retech-core/errors/validation"
                    title: "Invalid Parameters"
                    status: 400
                    detail: "Cidade e logradouro devem ter no m√≠nimo 3 caracteres"
                invalid_uf:
                  summary: "UF inv√°lida"
                  value:
                    type: "https://retech-core/errors/validation"
                    title: "Invalid UF"
                    status: 400
                    detail: "UF deve ter 2 caracteres (ex: SP, RJ, RS)"
        '404':
          description: Nenhum CEP encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                type: "https://retech-core/errors/not-found"
                title: "CEPs Not Found"
                status: 404
                detail: "Nenhum CEP encontrado para o endere√ßo informado"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '503':
          $ref: '#/components/responses/Maintenance'

  # ==========================================
  # CNPJ
  # ==========================================
  /cnpj/{numero}:
    get:
      tags: [CNPJ]
      summary: Consultar CNPJ
      description: |
        Consulta dados completos de uma empresa pelo CNPJ.
        
        **Fontes de Dados:**
        - ü•á **Brasil API** (principal - Receita Federal)
        - ü•à **ReceitaWS** (fallback)
        - üíæ **Cache** (30 dias)
        
        **Performance:**
        - Cache: < 10ms
        - Brasil API: ~200-500ms
        - ReceitaWS: ~500-1000ms
        
        **Formato aceito:**
        - Com formata√ß√£o: `00.000.000/0001-91`
        - Sem formata√ß√£o: `00000000000191`
        
        **Valida√ß√£o:**
        - ‚úÖ D√≠gito verificador obrigat√≥rio
        - ‚ùå CNPJs inv√°lidos retornam 400
        
      security:
        - ApiKeyAuth: []
      parameters:
        - name: numero
          in: path
          required: true
          description: "CNPJ brasileiro (com ou sem formata√ß√£o)"
          schema:
            type: string
            example: "00.000.000/0001-91"
      responses:
        '200':
          description: CNPJ encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CNPJ'
              examples:
                banco_do_brasil:
                  summary: "Banco do Brasil S.A."
                  value:
                    cnpj: "00000000000191"
                    razaoSocial: "BANCO DO BRASIL SA"
                    nomeFantasia: "BANCO DO BRASIL"
                    situacao: "ATIVA"
                    dataSituacao: "2005-11-03"
                    dataAbertura: "1966-08-30"
                    porte: "DEMAIS"
                    naturezaJuridica: "Sociedade de Economia Mista"
                    capitalSocial: 81250000000.00
                    endereco:
                      logradouro: "SBS Quadra 1 Bloco G"
                      numero: "S/N"
                      complemento: "LOJA LOJA 1 SUBSOLO 1"
                      bairro: "ASA SUL"
                      cep: "70073901"
                      municipio: "Bras√≠lia"
                      uf: "DF"
                    telefones: ["(61) 3493-9002"]
                    email: "prov@bb.com.br"
                    atividadePrincipal:
                      codigo: "64.21-2-00"
                      descricao: "Bancos comerciais"
                    atividadesSecundarias:
                      - codigo: "66.19-3-99"
                        descricao: "Outras atividades auxiliares dos servi√ßos financeiros"
                    qsa:
                      - nome: "EXEMPLO NOME SOCIO"
                        qualificacao: "Diretor"
                    source: "brasilapi"
                    cachedAt: "2025-10-23T22:30:00Z"
        '400':
          description: CNPJ inv√°lido (d√≠gito verificador errado)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                type: "https://retech-core/errors/validation"
                title: "CNPJ Inv√°lido"
                status: 400
                detail: "CNPJ deve ter 14 d√≠gitos v√°lidos"
        '404':
          description: CNPJ n√£o encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                type: "https://retech-core/errors/not-found"
                title: "CNPJ Not Found"
                status: 404
                detail: "CNPJ 99999999999999 n√£o encontrado ou indispon√≠vel"
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'

  # ==========================================
  # GEOGRAFIA
  # ==========================================
  /geo/ufs:
    get:
      tags: [Geografia]
      summary: Listar Estados
      description: |
        Retorna todos os 27 estados brasileiros com informa√ß√µes completas.
        
        **Exemplo de uso:**
        ```bash
        curl __API_BASE_URL__/geo/ufs \
          -H "X-API-Key: sua_api_key_aqui"
        ```
      security:
        - ApiKeyAuth: []
      responses:
        '200':
          description: Lista de estados
          content:
            application/json:
              schema:
                type: object
                properties:
                  estados:
                    type: array
                    items:
                      $ref: '#/components/schemas/Estado'
              example:
                estados:
                  - id: 26
                    sigla: "PE"
                    nome: "Pernambuco"
                    regiao:
                      id: 2
                      sigla: "NE"
                      nome: "Nordeste"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '503':
          $ref: '#/components/responses/Maintenance'

  /geo/ufs/{sigla}:
    get:
      tags: [Geografia]
      summary: Buscar Estado por Sigla
      description: |
        Retorna detalhes de um estado espec√≠fico pela sigla.
        
        **Exemplo de uso:**
        ```bash
        curl __API_BASE_URL__/geo/ufs/PE \
          -H "X-API-Key: sua_api_key_aqui"
        ```
      security:
        - ApiKeyAuth: []
      parameters:
        - name: sigla
          in: path
          required: true
          description: "Sigla do estado (ex: SP, RJ, PE)"
          schema:
            type: string
            example: "PE"
      responses:
        '200':
          description: Detalhes do estado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Estado'
              example:
                id: 26
                sigla: "PE"
                nome: "Pernambuco"
                regiao:
                  id: 2
                  sigla: "NE"
                  nome: "Nordeste"
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /geo/municipios:
    get:
      tags: [Geografia]
      summary: Listar Munic√≠pios
      description: |
        Retorna todos os munic√≠pios ou filtra por UF/nome.
        
        **Exemplo de uso:**
        ```bash
        # Todos os munic√≠pios
        curl __API_BASE_URL__/geo/municipios \
          -H "X-API-Key: sua_api_key_aqui"
        
        # Filtrar por UF
        curl "__API_BASE_URL__/geo/municipios?uf=PE" \
          -H "X-API-Key: sua_api_key_aqui"
        
        # Buscar por nome
        curl "__API_BASE_URL__/geo/municipios?q=Recife" \
          -H "X-API-Key: sua_api_key_aqui"
        ```
      security:
        - ApiKeyAuth: []
      parameters:
        - name: uf
          in: query
          description: "Filtrar por UF (ex: PE, SP)"
          schema:
            type: string
            example: "PE"
        - name: q
          in: query
          description: Buscar por nome
          schema:
            type: string
            example: "Recife"
      responses:
        '200':
          description: Lista de munic√≠pios
          content:
            application/json:
              schema:
                type: object
                properties:
                  municipios:
                    type: array
                    items:
                      $ref: '#/components/schemas/Municipio'

  /geo/municipios/{uf}:
    get:
      tags: [Geografia]
      summary: Munic√≠pios de um Estado
      description: |
        Retorna todos os munic√≠pios de um estado espec√≠fico.
        
        **Exemplo de uso:**
        ```bash
        curl __API_BASE_URL__/geo/municipios/PE \
          -H "X-API-Key: sua_api_key_aqui"
        ```
      security:
        - ApiKeyAuth: []
      parameters:
        - name: uf
          in: path
          required: true
          description: Sigla do estado
          schema:
            type: string
            example: "PE"
      responses:
        '200':
          description: Lista de munic√≠pios do estado
          content:
            application/json:
              schema:
                type: object
                properties:
                  municipios:
                    type: array
                    items:
                      $ref: '#/components/schemas/Municipio'

  # ==========================================
  # ARTIGOS PENAIS
  # ==========================================
  /penal/artigos:
    get:
      tags: [Artigos Penais]
      summary: Listar Artigos Penais (Autocomplete)
      description: |
        Retorna todos os artigos penais brasileiros, ideal para autocomplete/Select2.
        
        **Fontes de Dados:**
        - üíæ **Dados fixos** (seed inicial no MongoDB)
        - ü•á **Cache Redis** (permanente - ~1ms)
        - ü•à **MongoDB** (~10ms se cache miss)
        
        **Performance:**
        - Cache Redis: ~1ms
        - MongoDB: ~10ms
        - Dados fixos (n√£o expira)
        
        **Filtros Dispon√≠veis:**
        - `q` (opcional): Busca por texto na descricao
        - `tipo` (opcional): Filtrar por tipo (`crime` ou `contravencao`)
        - `legislacao` (opcional): Filtrar por legislacao (`CP`, `LCP`, `Lei 11.343/2006`, etc)
        
        **Uso tipico (Autocomplete/Select2):**
        ```javascript
        // React Select / Select2
        fetch('__API_BASE_URL__/penal/artigos?q=homicidio', {
          headers: { 'X-API-Key': 'sua_chave' }
        })
        .then(res => res.json())
        .then(data => {
          // data.data contem array de artigos
          const options = data.data.map(a => ({
            value: a.codigo,
            label: a.codigoFormatado + ' - ' + a.descricao
          }));
        });
        ```
        
        **Exemplo de uso:**
        ```bash
        # Listar todos os artigos
        curl __API_BASE_URL__/penal/artigos \
          -H "X-API-Key: sua_api_key_aqui"
        
        # Buscar artigos de homic√≠dio
        curl "__API_BASE_URL__/penal/artigos?q=homicidio" \
          -H "X-API-Key: sua_api_key_aqui"
        
        # Filtrar apenas crimes do CP
        curl "__API_BASE_URL__/penal/artigos?tipo=crime&legislacao=CP" \
          -H "X-API-Key: sua_api_key_aqui"
        ```
      security:
        - ApiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: false
          description: "Busca por texto (descricao, codigo, texto completo)"
          schema:
            type: string
            example: "homicidio"
        - name: tipo
          in: query
          required: false
          description: "Filtrar por tipo: crime ou contravencao"
          schema:
            type: string
            enum: [crime, contravencao]
            example: "crime"
        - name: legislacao
          in: query
          required: false
          description: "Filtrar por legislacao: CP, LCP, Lei 11.343/2006, etc"
          schema:
            type: string
            example: "CP"
      responses:
        '200':
          description: Lista de artigos penais
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  code:
                    type: string
                    example: "OK"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ArtigoPenal'
              examples:
                todos_artigos:
                  summary: "Todos os artigos (sem filtros)"
                  value:
                    success: true
                    code: "OK"
                    data:
                      - codigo: "121"
                        codigoFormatado: "Art. 121 do CP"
                        descricao: "Homic√≠dio simples"
                        tipo: "crime"
                        legislacao: "CP"
                        legislacaoNome: "Codigo Penal"
                      - codigo: "121.1"
                        codigoFormatado: "Art. 121, ¬ß 1¬∫ do CP"
                        descricao: "Homic√≠dio qualificado"
                        tipo: "crime"
                        legislacao: "CP"
                        legislacaoNome: "Codigo Penal"
                busca_texto:
                  summary: "Busca por texto (q=homicidio)"
                  value:
                    success: true
                    code: "OK"
                    data:
                      - codigo: "121"
                        codigoFormatado: "Art. 121 do CP"
                        descricao: "Homic√≠dio simples"
                        tipo: "crime"
                        legislacao: "CP"
                        legislacaoNome: "Codigo Penal"
                      - codigo: "121.1"
                        codigoFormatado: "Art. 121, ¬ß 1¬∫ do CP"
                        descricao: "Homic√≠dio qualificado"
                        tipo: "crime"
                        legislacao: "CP"
                        legislacaoNome: "Codigo Penal"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '503':
          $ref: '#/components/responses/Maintenance'

  /penal/artigos/{codigo}:
    get:
      tags: [Artigos Penais]
      summary: Buscar Artigo Penal Espec√≠fico
      description: |
        Retorna detalhes completos de um artigo penal especifico pelo codigo.

        **Formato do codigo:**
        - Artigo simples: `121`
        - Com par√°grafo: `121.1` (Art. 121, ¬ß 1¬∫)
        - Com inciso: `121.1.I` (Art. 121, ¬ß 1¬∫, I)
        - Com al√≠nea: `121.1.I.a` (Art. 121, ¬ß 1¬∫, I, a)
        
        **Performance:**
        - Cache Redis: ~1ms
        - MongoDB: ~10ms
        - Dados fixos (n√£o expira)
        
        **Exemplo de uso:**
        ```bash
        # Buscar artigo 121 (homic√≠dio simples)
        curl __API_BASE_URL__/penal/artigos/121 \
          -H "X-API-Key: sua_api_key_aqui"
        
        # Buscar par√°grafo 1¬∫ do artigo 121
        curl __API_BASE_URL__/penal/artigos/121.1 \
          -H "X-API-Key: sua_api_key_aqui"
        
        # Buscar inciso I do par√°grafo 1¬∫ do artigo 121
        curl __API_BASE_URL__/penal/artigos/121.1.I \
          -H "X-API-Key: sua_api_key_aqui"
        ```
      security:
        - ApiKeyAuth: []
      parameters:
        - name: codigo
          in: path
          required: true
          description: "Codigo do artigo (ex: 121, 121.1, 121.1.I, 121.1.I.a)"
          schema:
            type: string
            example: "121"
      responses:
        '200':
          description: Artigo encontrado
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  code:
                    type: string
                    example: "OK"
                  data:
                    $ref: '#/components/schemas/ArtigoPenalCompleto'
              examples:
                homicidio_simples:
                  summary: "Art. 121 - Homic√≠dio simples"
                  value:
                    success: true
                    code: "OK"
                    data:
                      codigo: "121"
                      codigoFormatado: "Art. 121 do CP"
                      artigo: 121
                      descricao: "Homic√≠dio simples"
                      textoCompleto: "Matar algu√©m:\nPena - reclus√£o, de 6 (seis) a 20 (vinte) anos."
                      tipo: "crime"
                      legislacao: "CP"
                      legislacaoNome: "C√≥digo Penal"
                      penaMin: "Reclus√£o, de 6 a 20 anos"
                      penaMax: ""
                homicidio_qualificado:
                  summary: "Art. 121, ¬ß 1¬∫ - Homic√≠dio qualificado"
                  value:
                    success: true
                    code: "OK"
                    data:
                      codigo: "121.1"
                      codigoFormatado: "Art. 121, ¬ß 1¬∫ do CP"
                      artigo: 121
                      paragrafo: 1
                      descricao: "Homic√≠dio qualificado"
                      textoCompleto: "Se o homic√≠dio √© cometido:\nI - mediante pago, promessa de recompensa ou motivo f√∫til;\nII - por motivo de relevante valor social ou moral;\nIII - contra ascendente, descendente, c√¥njuge, companheiro ou irm√£o;\nIV - com emprego de veneno, fogo, explosivo, asfixia, tortura ou outro meio insidioso ou cruel, ou que possa resultar perigo comum;\nV - √† trai√ß√£o, de emboscada, ou mediante dissimula√ß√£o ou outro recurso que dificulte ou torne imposs√≠vel a defesa do ofendido;\nVI - contra autoridade ou contra membro de conselho tutelar, do Minist√©rio P√∫blico, da Magistratura ou do Tribunal de Contas, no exerc√≠cio da fun√ß√£o ou em raz√£o dela, ou contra seu c√¥njuge, ascendente ou descendente;\nVII - contra crian√ßa, adolescente, gestante, deficiente f√≠sico ou mental ou pessoa maior de 60 (sessenta) anos;\nVIII - que decorra de viol√™ncia dom√©stica e familiar ou de discrimina√ß√£o ou preconceito de ra√ßa, cor, etnia, religi√£o, origem, condi√ß√£o de pessoa idosa, crian√ßa, adolescente ou pessoa com defici√™ncia;\nIX - contra membro de grupo vulner√°vel, em raz√£o da condi√ß√£o de vulnerabilidade.\nPena - reclus√£o, de 12 (doze) a 30 (trinta) anos."
                      tipo: "crime"
                      legislacao: "CP"
                      legislacaoNome: "C√≥digo Penal"
                      penaMin: "Reclus√£o, de 12 a 30 anos"
                      penaMax: ""
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '503':
          $ref: '#/components/responses/Maintenance'

  /penal/search:
    get:
      tags: [Artigos Penais]
      summary: Buscar Artigos por Texto
      description: |
        Busca artigos penais por texto na descricao ou texto completo.
        
        **Fontes de Dados:**
        - üíæ **Dados fixos** (seed inicial no MongoDB)
        - ü•á **Cache Redis** (permanente - ~1ms)
        - ü•à **MongoDB** (~10ms se cache miss)
        
        **Performance:**
        - Cache Redis: ~1ms
        - MongoDB text search: ~50ms
        - Dados fixos (n√£o expira)
        
        **Busca inteligente:**
        - Busca no campo `busca` (normalizado, lowercase, sem acentos)
        - Busca em descricao, texto completo e codigo formatado
        - Case-insensitive
        - Aceita termos parciais
        
        **Exemplo de uso:**
        ```bash
        # Buscar artigos sobre "matar algu√©m"
        curl "__API_BASE_URL__/penal/search?q=matar%20alguem" \
          -H "X-API-Key: sua_api_key_aqui"
        
        # Buscar artigos sobre "roubo"
        curl "__API_BASE_URL__/penal/search?q=roubo" \
          -H "X-API-Key: sua_api_key_aqui"
        ```
        
        **‚ö†Ô∏è Tratamento de dados:**
        - ‚úÖ **Acentos:** Aceita com ou sem acentos ("homicidio" = "homic√≠dio")
        - ‚úÖ **Case:** Mai√∫sculas/min√∫sculas n√£o importam ("HOMICIDIO" = "homicidio")
        - ‚úÖ **Encoding:** Autom√°tico pelo backend (espa√ßos: + ou %20)
        - ‚ö†Ô∏è **Formato:** Use espa√ßos ou + para separar palavras
      security:
        - ApiKeyAuth: []
      parameters:
        - name: q
          in: query
          required: true
          description: "Texto a buscar (descricao, texto completo ou codigo)"
          schema:
            type: string
            example: "matar algu√©m"
      responses:
        '200':
          description: Artigos encontrados
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  code:
                    type: string
                    example: "OK"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ArtigoPenalCompleto'
              examples:
                busca_matamento:
                  summary: "Busca por 'matar algu√©m'"
                  value:
                    success: true
                    code: "OK"
                    data:
                      - codigo: "121"
                        codigoFormatado: "Art. 121 do CP"
                        descricao: "Homic√≠dio simples"
                        textoCompleto: "Matar algu√©m:\nPena - reclus√£o, de 6 (seis) a 20 (vinte) anos."
                        tipo: "crime"
                        legislacao: "CP"
                        legislacaoNome: "Codigo Penal"
        '400':
          description: Par√¢metro de busca inv√°lido (q obrigat√≥rio)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                type: "https://retech-core/errors/validation"
                title: "Validation Error"
                status: 400
                detail: "Par√¢metro 'q' √© obrigat√≥rio para busca"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '503':
          $ref: '#/components/responses/Maintenance'

components:
  schemas:
    CEP:
      type: object
      description: Representa um endere√ßo completo a partir de um CEP
      properties:
        cep:
          type: string
          description: CEP formatado
          example: "01310-100"
        logradouro:
          type: string
          description: Nome da rua/avenida
          example: "Avenida Paulista"
        complemento:
          type: string
          description: Complemento do endere√ßo (ex. "de 612 a 1510 - lado par")
          example: "de 612 a 1510 - lado par"
        bairro:
          type: string
          description: Nome do bairro
          example: "Bela Vista"
        localidade:
          type: string
          description: Nome da cidade
          example: "S√£o Paulo"
        uf:
          type: string
          description: Sigla do estado
          example: "SP"
        ibge:
          type: string
          description: Codigo IBGE do municipio
          example: "3550308"
        ddd:
          type: string
          description: Codigo DDD
          example: "11"
        latitude:
          type: number
          format: float
          description: Latitude (quando dispon√≠vel)
          example: -23.5617
        longitude:
          type: number
          format: float
          description: Longitude (quando dispon√≠vel)
          example: -46.6562
        source:
          type: string
          description: Fonte dos dados
          enum: [viacep, brasilapi, cache]
          example: "viacep"
        cachedAt:
          type: string
          format: date-time
          description: Data/hora do cache (quando aplic√°vel)
          example: "2025-10-23T15:30:00Z"

    CNPJ:
      type: object
      description: Representa uma empresa brasileira com dados da Receita Federal
      properties:
        cnpj:
          type: string
          description: CNPJ (apenas n√∫meros)
          example: "00000000000191"
        razaoSocial:
          type: string
          description: Raz√£o social (nome legal)
          example: "BANCO DO BRASIL SA"
        nomeFantasia:
          type: string
          description: Nome fantasia (marca)
          example: "BANCO DO BRASIL"
        situacao:
          type: string
          description: Situa√ß√£o cadastral
          enum: [ATIVA, BAIXADA, SUSPENSA, INAPTA, NULA]
          example: "ATIVA"
        dataSituacao:
          type: string
          format: date
          description: Data da situa√ß√£o cadastral
          example: "2005-11-03"
        dataAbertura:
          type: string
          format: date
          description: Data de abertura/constitui√ß√£o
          example: "1966-08-30"
        porte:
          type: string
          description: Porte da empresa
          enum: [MEI, MICRO EMPRESA, EMPRESA DE PEQUENO PORTE, DEMAIS]
          example: "DEMAIS"
        naturezaJuridica:
          type: string
          description: Natureza jur√≠dica
          example: "Sociedade de Economia Mista"
        capitalSocial:
          type: number
          format: double
          description: Capital social em reais
          example: 81250000000.00
        endereco:
          $ref: '#/components/schemas/CNPJEndereco'
        telefones:
          type: array
          items:
            type: string
          description: Lista de telefones
          example: ["(61) 3493-9002"]
        email:
          type: string
          format: email
          description: E-mail da empresa
          example: "prov@bb.com.br"
        atividadePrincipal:
          $ref: '#/components/schemas/CNPJAtividade'
        atividadesSecundarias:
          type: array
          items:
            $ref: '#/components/schemas/CNPJAtividade'
          description: Lista de CNAEs secund√°rios
        qsa:
          type: array
          items:
            $ref: '#/components/schemas/CNPJSocio'
          description: Quadro de S√≥cios e Administradores
        source:
          type: string
          description: Fonte dos dados
          enum: [brasilapi, receitaws, cache]
          example: "brasilapi"
        cachedAt:
          type: string
          format: date-time
          description: Data/hora do cache
          example: "2025-10-23T22:30:00Z"

    CNPJEndereco:
      type: object
      description: Endere√ßo da empresa
      properties:
        logradouro:
          type: string
          example: "SBS Quadra 1 Bloco G"
        numero:
          type: string
          example: "S/N"
        complemento:
          type: string
          example: "LOJA LOJA 1 SUBSOLO 1"
        bairro:
          type: string
          example: "ASA SUL"
        cep:
          type: string
          example: "70073901"
        municipio:
          type: string
          example: "Bras√≠lia"
        uf:
          type: string
          example: "DF"

    CNPJAtividade:
      type: object
      description: Atividade econ√¥mica (CNAE)
      properties:
        codigo:
          type: string
          description: Codigo CNAE
          example: "64.21-2-00"
        descricao:
          type: string
          description: Descricao da atividade
          example: "Bancos comerciais"

    CNPJSocio:
      type: object
      description: S√≥cio ou administrador
      properties:
        nome:
          type: string
          description: Nome completo
          example: "JO√ÉO DA SILVA"
        qualificacao:
          type: string
          description: Cargo/qualifica√ß√£o
          example: "Diretor"

    Estado:
      type: object
      description: Representa um estado brasileiro
      properties:
        id:
          type: integer
          description: Codigo IBGE do estado
          example: 26
        sigla:
          type: string
          description: Sigla UF (2 caracteres)
          example: "PE"
        nome:
          type: string
          description: Nome do estado
          example: "Pernambuco"
        regiao:
          $ref: '#/components/schemas/Regiao'

    Regiao:
      type: object
      description: Regi√£o geogr√°fica brasileira
      properties:
        id:
          type: integer
          description: Codigo IBGE da regiao
          example: 2
        sigla:
          type: string
          description: Sigla da regi√£o
          example: "NE"
        nome:
          type: string
          description: Nome da regi√£o
          example: "Nordeste"

    Municipio:
      type: object
      description: Representa um munic√≠pio brasileiro
      properties:
        id:
          type: integer
          description: Codigo IBGE do municipio
          example: 2611606
        nome:
          type: string
          description: Nome do munic√≠pio
          example: "Recife"
        microrregiao:
          type: object
          description: Microrregi√£o do IBGE
        regiao-imediata:
          type: object
          description: Regi√£o imediata (nova divis√£o IBGE)

    ArtigoPenal:
      type: object
      description: Artigo penal resumido (para autocomplete/Select2)
      properties:
        codigo:
          type: string
          description: Codigo do artigo (ex "121", "121.1", "121.1.I")
          example: "121"
        codigoFormatado:
          type: string
          description: Codigo formatado para exibicao (ex "Art. 121 do CP")
          example: "Art. 121 do CP"
        descricao:
          type: string
          description: Descricao resumida do artigo
          example: "Homicidio simples"
        tipo:
          type: string
          description: Tipo (crime ou contravencao)
          example: "crime"
          enum: 
            - crime
            - contravencao
        legislacao:
          type: string
          description: Codigo da legislacao (CP, LCP, etc)
          example: "CP"
        legislacaoNome:
          type: string
          description: Nome completo da legislacao
          example: "Codigo Penal"
        idUnico:
          type: string
          description: Identificador unico no formato "LEGISLACAO:CODIGO" para evitar ambiguidade quando o mesmo codigo aparece em multiplas legislacoes
          example: "CP:121"

    ArtigoPenalCompleto:
      type: object
      description: Artigo penal completo (com todos os detalhes)
      allOf:
        - $ref: '#/components/schemas/ArtigoPenal'
        - type: object
          properties:
            artigo:
              type: integer
              description: N√∫mero do artigo
              example: 121
            paragrafo:
              type: integer
              nullable: true
              description: N√∫mero do par√°grafo (se aplic√°vel)
              example: 1
            inciso:
              type: string
              nullable: true
              description: Inciso (se aplic√°vel)
              example: "I"
            alinea:
              type: string
              nullable: true
              description: Al√≠nea (se aplic√°vel)
              example: "a"
            textoCompleto:
              type: string
              description: Texto completo do artigo
              example: "Matar algu√©m:\nPena - reclus√£o, de 6 (seis) a 20 (vinte) anos."
            penaMin:
              type: string
              nullable: true
              description: Penalidade m√≠nima
              example: "Reclus√£o, de 6 a 20 anos"
            penaMax:
              type: string
              nullable: true
              description: Penalidade m√°xima
              example: ""
            createdAt:
              type: string
              format: date-time
              description: Data de cria√ß√£o
            updatedAt:
              type: string
              format: date-time
              description: Data de atualiza√ß√£o
            hashConteudo:
              type: string
              description: Hash SHA256 do conteudo para rastreamento de alteracoes na fonte oficial
              example: "a1b2c3d4e5f6..."
            idUnico:
              type: string
              description: Identificador unico no formato "LEGISLACAO:CODIGO" para evitar ambiguidade
              example: "CP:121"

    Error:
      type: object
      description: Resposta de erro padronizada (RFC 7807)
      properties:
        type:
          type: string
          description: URI que identifica o tipo de erro
          example: "https://retech-core/errors/not-found"
        title:
          type: string
          description: Resumo do erro
          example: "Not Found"
        status:
          type: integer
          description: Codigo HTTP
          example: 404
        detail:
          type: string
          description: Explica√ß√£o detalhada do erro
          example: "Recurso n√£o encontrado"

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: |
        ## Como usar sua API Key
        
        Todas as requisi√ß√µes para endpoints `/geo/*` requerem autentica√ß√£o via API Key.
        
        **Passo 1: Obter sua API Key**
        
        Acesse o [Portal do Desenvolvedor](https://core.theretech.com.br/painel/apikeys) e gere uma nova chave.
        
        **Passo 2: Usar no header**
        
        ```bash
        curl __API_BASE_URL__/geo/ufs \
          -H "X-API-Key: sua_api_key_aqui"
        ```
        
        **Rate Limits:**
        - Plano Free: 1.000 requests/dia, 60/min
        - Plano Pro: 10.000 requests/dia, 200/min

  responses:
    Unauthorized:
      description: N√£o autorizado - API Key inv√°lida ou ausente
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            type: "https://retech-core/errors/unauthorized"
            title: "Unauthorized"
            status: 401
            detail: "API Key inv√°lida ou ausente. Use o header X-API-Key com uma chave v√°lida."

    NotFound:
      description: Recurso n√£o encontrado
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            type: "https://retech-core/errors/not-found"
            title: "Not Found"
            status: 404
            detail: "O recurso solicitado n√£o foi encontrado."

    TooManyRequests:
      description: Rate limit excedido
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            type: "https://retech-core/errors/rate-limit"
            title: "Too Many Requests"
            status: 429
            detail: "Voc√™ excedeu o limite de requisi√ß√µes. Tente novamente mais tarde."

    Maintenance:
      description: API em manuten√ß√£o
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            type: "https://retech-core/errors/maintenance"
            title: "API em Manuten√ß√£o"
            status: 503
            detail: "A API est√° temporariamente indispon√≠vel para manuten√ß√£o. Por favor, tente novamente mais tarde."
