# üöÄ ROADMAP RETECH CORE API

**Atualizado:** 27 de Outubro de 2025 üÜï  
**Status:** Fase 1 Conclu√≠da ‚úÖ | Fase 2 Em Andamento üîµ (2/6 APIs - 33%) | Infraestrutura Avan√ßada ‚úÖ

---

## ‚ö° **RESUMO EXECUTIVO - OUT/2025**

### **üéâ Principais Conquistas:**
1. ‚úÖ **3 APIs Completas** - CEP, CNPJ, Geografia (4 endpoints)
2. ‚úÖ **Cache 3 Camadas** - Redis L1 (~1ms) + MongoDB L2 (~10ms) + API L3 (~200ms)
3. ‚úÖ **Playground P√∫blico** - Teste sem cadastro + Browser fingerprinting
4. ‚úÖ **Seguran√ßa Refor√ßada** - HMAC-SHA256 + Scopes + Rate limiting multi-camada
5. ‚úÖ **SEO Completo** - Meta tags + Sitemap + Ferramentas p√∫blicas
6. ‚úÖ **Admin Dashboard** - Controles independentes + Stats + Analytics (timezone BR)

### **üöÄ Pr√≥ximo Grande Passo:**
**Migra√ß√£o Oracle Cloud (S√£o Paulo)** - Reduzir lat√™ncia de 160ms ‚Üí 5-15ms  
**Custo:** R$ 0/m√™s (Always Free Tier) | **Prazo:** 2-4 semanas

### **üí∞ Performance vs Custo:**
- **Atual:** Railway EUA (~160ms) - $5-10/m√™s
- **Futuro:** Oracle BR (~5-15ms) - **R$ 0/m√™s** ‚úÖ
- **Ganho:** 10-30x mais r√°pido + Gratuito!

---

## üìä PROGRESSO GERAL

```
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 25% (9/36 APIs)

Fase 1: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100% ‚úÖ
Fase 2: ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  33% üîµ (2/6)
Fase 3: ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   0% ‚ö™ (0/17)
Fase 4: ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   0% ‚ö™ (0/7)
```

**APIs Totais:** 36 (+5 novas: NF-e, CND, Compras Gov, Protestos, Score) üÜï  
**Dispon√≠veis:** 3 (Geografia + CEP + CNPJ) üöÄ  
**Em Desenvolvimento:** 4 (Fase 2)  
**Planejadas:** 29

---

## ‚úÖ FASE 1 - FUNDA√á√ÉO (CONCLU√çDA)

### **üéØ Infraestrutura Core**
- [x] Arquitetura Go + Gin + MongoDB
- [x] Autentica√ß√£o JWT (SUPER_ADMIN + TENANT_USER)
- [x] API Key Management (cria√ß√£o, revoga√ß√£o, rota√ß√£o)
- [x] Rate Limiting por tenant (daily + per-minute)
- [x] Usage Logging (API usage tracking)
- [x] Activity Logs (auditoria completa)
- [x] Maintenance Mode
- [x] Docker + Docker Compose
- [x] Deploy Railway (backend + frontend)

### **üé® Frontend (Admin + Developer Portal)**
- [x] Admin Dashboard (gest√£o de tenants, API keys, settings)
- [x] Developer Portal (dashboard, usage, docs)
- [x] Landing Page com 31 APIs documentadas
- [x] Sistema de autentica√ß√£o completo
- [x] Real-time metrics (auto-refresh 30s)

### **üìö Documenta√ß√£o**
- [x] OpenAPI 3.0 (Redoc)
- [x] URL din√¢mica (dev/prod)
- [x] Documenta√ß√£o focada em desenvolvedores
- [x] Exemplos de c√≥digo funcionais

### **üó∫Ô∏è API: Geografia (DISPON√çVEL)**
- [x] `GET /geo/ufs` - Lista 27 estados
- [x] `GET /geo/ufs/:sigla` - Detalhes de estado
- [x] `GET /geo/municipios` - Lista 5.570 munic√≠pios
- [x] `GET /geo/municipios/:uf` - Munic√≠pios por UF
- [x] `GET /public/geo/*` - Endpoints p√∫blicos para playground
- [x] Dados do IBGE (completos)
- [x] **Cache Redis L1:**
  - [x] Estados (ufs:all) - cache permanente
  - [x] Munic√≠pios por UF - cache permanente
- [x] Performance: ~1ms (Redis) / ~160ms (primeira consulta)
- [x] Scope: `geo` (controle granular de acesso)

### **‚ö° Performance & Cache (IMPLEMENTADO)** ‚úÖ üÜï
- [x] **Redis Cache (L1 - Hot Cache):**
  - [x] Conex√£o Redis configur√°vel via `REDIS_URL`
  - [x] Cache em mem√≥ria (~1ms)
  - [x] Keys separadas por servi√ßo (cep:*, cnpj:*, geo:*)
  - [x] TTL: 24h para hot data
  - [x] Graceful degradation (se cair, usa MongoDB)
  - [x] Monitoramento: stats de keys, mem√≥ria usada
  - [x] Admin: Limpar cache Redis (all, cep, cnpj)
  
- [x] **MongoDB Cache (L2 - Persistent Cache):**
  - [x] Cache persistente (~10ms)
  - [x] TTL independente por servi√ßo (CEP: 7 dias, CNPJ: 30 dias)
  - [x] Auto-cleanup via TTL Index
  - [x] Promo√ß√£o autom√°tica para Redis quando hit
  - [x] Stats: total cached, recent 24h
  - [x] Admin: Controles independentes (CEP e CNPJ)

- [x] **MongoDB Indexes (Auto-cria√ß√£o):**
  - [x] API Keys: keyId (unique), ownerId, scopes
  - [x] Tenants: email (unique), active
  - [x] Users: email (unique), tenantId
  - [x] CEP Cache: cep (unique), cachedAt (TTL)
  - [x] CNPJ Cache: cnpj (unique), cachedAt (TTL)
  - [x] API Usage: date+apiKey, tenantId+date, endpoint+date
  - [x] Activity Logs: userId, createdAt (desc)
  - [x] Playground Rate Limits: ip+apiKey+date (unique)
  - [x] Indexes aplicados automaticamente no startup (migrations-like)

- [x] **Settings Cache (In-Memory):**
  - [x] Cache de configura√ß√µes do sistema em mem√≥ria
  - [x] Evita consultas frequentes ao MongoDB
  - [x] Invalida√ß√£o autom√°tica ao salvar settings

### **üîí Seguran√ßa Avan√ßada (IMPLEMENTADO)** ‚úÖ üÜï
- [x] **API Key Management:**
  - [x] Formato seguro: `keyId.keySecret`
  - [x] Hash HMAC-SHA256 com salt (`APIKEY_HASH_SECRET`)
  - [x] KeyHash armazenado (nunca a chave em texto)
  - [x] Valida√ß√£o obrigat√≥ria de `APIKEY_HASH_SECRET`
  - [x] Panic se vari√°vel n√£o configurada (seguran√ßa)
  - [x] API Key oculta no frontend (üîí ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢)
  - [x] Cria√ß√£o, rota√ß√£o e revoga√ß√£o de chaves

- [x] **Sistema de Scopes:**
  - [x] Scopes granulares: `cep`, `cnpj`, `geo`, `all`
  - [x] Middleware `RequireScope` em todas as rotas p√∫blicas
  - [x] Valida√ß√£o autom√°tica de permiss√µes
  - [x] Retrocompatibilidade (aceita `geo:read` e `geo`)
  - [x] Frontend com sele√ß√£o visual (checkboxes)

- [x] **Rate Limiting Multi-Camada:**
  - [x] **Por Tenant:** Daily + Per-minute (configur√°vel)
  - [x] **Por IP (Playground):** 4/dia, 1/min (configur√°vel)
  - [x] **Global (Playground):** Compartilhado entre todos os IPs
  - [x] Reset autom√°tico por minuto
  - [x] Logs detalhados de debug
  - [x] MongoDB indexes otimizados

- [x] **Playground Seguro:**
  - [x] API Key Demo gerenci√°vel via admin/settings
  - [x] Scopes auto-rotacionados ao mudar checkboxes
  - [x] Rate limiting dedicado (IP + Global)
  - [x] Browser fingerprinting (coleta sem travar UI)
  - [x] Throttling (delay m√≠nimo entre requests)
  - [x] Toggle enable/disable via admin
  - [x] Configura√ß√£o de APIs permitidas

- [x] **CORS Din√¢mico:**
  - [x] Enable/disable via admin/settings
  - [x] Origins configur√°veis (textarea)
  - [x] Strict mode (sem exce√ß√µes para localhost)
  - [x] Headers personalizados permitidos
  - [x] Respostas 204/200 para OPTIONS

- [x] **JWT Din√¢mico:**
  - [x] Access TTL configur√°vel (padr√£o: 15min)
  - [x] Refresh TTL configur√°vel (padr√£o: 7 dias)
  - [x] Atualiza√ß√£o em tempo real via admin/settings
  - [x] Roles: SUPER_ADMIN, TENANT_USER

### **üìä Analytics & Monitoring (IMPLEMENTADO)** ‚úÖ üÜï
- [x] **Dashboard Admin:**
  - [x] Stats globais (tenants, API keys, users, requests)
  - [x] Gr√°ficos de uso di√°rio (√∫ltimos 30 dias)
  - [x] M√©tricas em tempo real (auto-refresh 30s)
  - [x] Top endpoints mais usados
  - [x] Timezone Bras√≠lia (America/Sao_Paulo)
  - [x] Formata√ß√£o de datas pt-BR

- [x] **Usage Tracking:**
  - [x] Log de todas as requests (endpoint, tenant, timestamp)
  - [x] Agrega√ß√£o por dia, tenant, endpoint
  - [x] Rate limit tracking (daily + per-minute)
  - [x] MongoDB indexes para queries r√°pidas

- [x] **Activity Logs:**
  - [x] Auditoria completa de a√ß√µes do sistema
  - [x] Login, cria√ß√£o de API Keys, updates de settings
  - [x] UserID, email, role, timestamp

- [x] **Redis Monitoring:**
  - [x] Total keys, keys por servi√ßo (CEP, CNPJ, GEO)
  - [x] Mem√≥ria usada (MB)
  - [x] Status de conex√£o (conectado/desconectado)
  - [x] Admin dashboard com stats em tempo real

---

## üîµ FASE 2 - DADOS ESSENCIAIS (0-3 MESES)

**Meta:** 6 APIs | **Status:** 2/6 Conclu√≠das (33%)

### **üìÆ CEP (DISPON√çVEL)** ‚úÖ
- [x] `GET /cep/:codigo` - Busca por CEP (CEP ‚Üí Endere√ßo)
- [x] `GET /cep/buscar` - Busca reversa (Endere√ßo ‚Üí CEP) üÜï
- [x] `GET /public/cep/:codigo` - Endpoint p√∫blico para playground/ferramentas
- [x] `GET /public/cep/buscar` - Endpoint p√∫blico para busca reversa üÜï
- [x] Integra√ß√£o: ViaCEP (gratuito)
- [x] Fallback: Brasil API
- [x] **Cache 3 Camadas:**
  - [x] Redis L1 (~1ms) - Hot cache em mem√≥ria
  - [x] MongoDB L2 (~10ms) - Cache persistente
  - [x] API Externa L3 (~200ms) - ViaCEP/Brasil API
- [x] **Busca Reversa:** üÜï
  - [x] Par√¢metros: uf, cidade, logradouro (m√≠n. 3 caracteres)
  - [x] Retorna at√© 50 CEPs por busca
  - [x] Cache independente (search:uf:cidade:logradouro)
  - [x] Ferramenta p√∫blica: `/ferramentas/buscar-cep` üÜï
- [x] TTL configur√°vel: 1-365 dias (padr√£o: 7 dias)
- [x] Coordenadas geogr√°ficas
- [x] Normaliza√ß√£o autom√°tica (com/sem tra√ßo)
- [x] Performance: ~1ms (Redis) / ~10ms (MongoDB) / ~160ms (API)
- [x] **Admin Settings:**
  - [x] Toggle independente CEP (enable/disable)
  - [x] TTL din√¢mico (1-365 dias)
  - [x] Auto-cleanup (MongoDB TTL Index)
  - [x] Stats em tempo real (total cached, recent 24h)
  - [x] Limpeza manual (bot√£o destrutivo com confirma√ß√£o)
- [x] Scope: `cep` (controle granular de acesso)
- [x] Graceful degradation (Redis cai ‚Üí MongoDB funciona)

### **üè¢ CNPJ (DISPON√çVEL)** ‚úÖ
- [x] `GET /cnpj/:numero` - Consulta CNPJ
- [x] `GET /public/cnpj/:numero` - Endpoint p√∫blico para playground/ferramentas
- [x] Fonte: Brasil API (gratuita, Receita Federal)
- [x] Fallback: ReceitaWS
- [x] **Cache 3 Camadas:**
  - [x] Redis L1 (~1ms) - Hot cache em mem√≥ria
  - [x] MongoDB L2 (~10ms) - Cache persistente
  - [x] API Externa L3 (~200ms) - Brasil API
- [x] TTL configur√°vel: 1-365 dias (padr√£o: 30 dias)
- [x] Valida√ß√£o: D√≠gito verificador + normaliza√ß√£o
- [x] Dados: raz√£o social, nome fantasia, situa√ß√£o
- [x] QSA: Quadro de s√≥cios e administradores
- [x] CNAEs: Atividade principal + secund√°rias
- [x] Endere√ßo completo + contatos
- [x] Performance: ~1ms (Redis) / ~10ms (MongoDB) / ~200ms (Brasil API)
- [x] **Admin Settings:**
  - [x] Toggle independente CNPJ (enable/disable)
  - [x] TTL din√¢mico (1-365 dias)
  - [x] Auto-cleanup (MongoDB TTL Index)
  - [x] Stats em tempo real (total cached, recent 24h)
  - [x] Limpeza manual (bot√£o destrutivo com confirma√ß√£o)
- [x] Scope: `cnpj` (controle granular de acesso)
- [x] Graceful degradation (Redis cai ‚Üí MongoDB funciona)

### **üíµ Moedas**
- [ ] `GET /moedas/cotacao` - Cota√ß√µes em tempo real
- [ ] Fonte: Banco Central API (gratuita)
- [ ] Moedas: USD, EUR, BTC
- [ ] Cache: 1 hora
- [ ] Hist√≥rico: √∫ltimos 30 dias

### **üè¶ Bancos**
- [ ] `GET /bancos` - Lista bancos brasileiros
- [ ] `GET /bancos/:codigo` - Busca por c√≥digo
- [ ] Fonte: Banco Central (dados p√∫blicos STR)
- [ ] Dados: COMPE, ISPB, nome completo
- [ ] Cache local permanente (atualiza√ß√£o mensal)

### **üöó FIPE**
- [ ] `GET /fipe/marcas` - Marcas de ve√≠culos
- [ ] `GET /fipe/veiculos/:codigo` - Pre√ßo FIPE
- [ ] Fonte: FIPE API (gratuita via Denatran)
- [ ] Cache: 7 dias
- [ ] Filtros: marca, modelo, ano

### **üìÖ Feriados**
- [ ] `GET /feriados/:ano` - Feriados nacionais
- [ ] `GET /feriados/:uf/:ano` - Feriados estaduais
- [ ] Fonte: Arquivo local + leis federais
- [ ] Cache permanente (gerado por ano)
- [ ] Tipos: nacional, estadual, municipal, ponto facultativo

### **üì± Telefone (PLANEJADO)** üÜï

#### **Objetivo:**
Valida√ß√£o de telefones brasileiros com diferencial √∫nico: **WhatsApp Verification real** via Evolution API auto-hospedada (custo ZERO).

#### **Features Planejadas:**

**1. WhatsApp Validator** ‚úÖ (Diferencial Competitivo)
- [ ] `GET /phone/:numero` - Valida√ß√£o completa de telefone
- [ ] **WhatsApp Verification:** Consulta REAL na rede WhatsApp (via Evolution API)
  - Custo: R$ 0 (Evolution auto-hospedada)
  - Confiabilidade: 100% (verifica√ß√£o real, n√£o heur√≠stica)
  - Retorna: `{ exists: true/false, jid: "number@s.whatsapp.net" }`
- [ ] **Valida√ß√£o de Formato:** Regras ANATEL (95-98% preciso)
  - 11 d√≠gitos ‚Üí m√≥vel (9¬∫ d√≠gito obrigat√≥rio)
  - 10 d√≠gitos ‚Üí fixo (primeiro d√≠gito 2-5)
  - DDDs v√°lidos (11-99, exceto inv√°lidos)
- [ ] **Tipo:** Mobile ou Landline (99%+ preciso)
  - Baseado em 9¬∫ d√≠gito (Lei 12.249/2010)
  - Sem exce√ß√µes conhecidas
- [ ] **DDD ‚Üí Localiza√ß√£o:** Estado e cidades poss√≠veis (100% preciso)
  - Integra√ß√£o: BrasilAPI (`GET /ddd/v1/:ddd`)
  - Fallback: Tabela local
  - Cache: Permanente (DDDs n√£o mudam)
- [ ] **Cache 3 Camadas:**
  - Redis L1 (~1ms)
  - MongoDB L2 (~10ms)
  - Evolution API L3 (~100-500ms)
- [ ] **Scope:** `phone`

**Response Exemplo:**
```json
{
  "numero": "5548988612609",
  "valido": true,
  "tipo": "mobile",
  "ddd": "48",
  "estado": "SC",
  "cidades_possiveis": ["Florian√≥polis", "S√£o Jos√©", "Palho√ßa"],
  "whatsapp": {
    "existe": true,
    "jid": "5548988612609@s.whatsapp.net",
    "verificado_em": "2025-10-28T22:00:00Z"
  },
  "observacoes": {
    "formato": "Validado segundo regras ANATEL",
    "tipo": "Baseado em 9¬∫ d√≠gito obrigat√≥rio",
    "localizacao": "DDD pode abranger m√∫ltiplas cidades",
    "whatsapp": "Verifica√ß√£o real na rede WhatsApp"
  }
}
```

**2. WhatsApp OTP** üî• (Inova√ß√£o - Custo Zero)
- [ ] `POST /phone/otp/send` - Enviar c√≥digo OTP via WhatsApp
- [ ] `POST /phone/otp/verify` - Validar c√≥digo OTP

**Fluxo WhatsApp OTP:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Dev App   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ POST /phone/otp/send
       ‚îÇ {
       ‚îÇ   "numero": "5548988612609",
       ‚îÇ   "ttl": 300,          // Segundos (opcional, padr√£o: 300)
       ‚îÇ   "digits": 6,         // Tamanho c√≥digo (opcional, padr√£o: 6)
       ‚îÇ   "template": "custom" // Template (opcional, padr√£o: "default")
       ‚îÇ }
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Retech Core API    ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ 1. Valida formato   ‚îÇ
‚îÇ 2. Checa WhatsApp   ‚îÇ ‚Üê Evolution API (verificar se n√∫mero existe)
‚îÇ 3. Verifica quota   ‚îÇ ‚Üê Limites por plano (100/1k/10k OTPs/m√™s)
‚îÇ 4. Rate limit       ‚îÇ ‚Üê M√°x 3 OTPs/5min por n√∫mero (anti-spam)
‚îÇ 5. Gera OTP         ‚îÇ ‚Üê 4-8 d√≠gitos aleat√≥rio
‚îÇ 6. Salva Redis      ‚îÇ
‚îÇ    Key: phone:otp:{numero}
‚îÇ    TTL: Configur√°vel (padr√£o: 5 min)
‚îÇ    Data: {
‚îÇ      code: "123456",
‚îÇ      used: false,
‚îÇ      attempts: 0,
‚îÇ      tenant: "tenant_id",
‚îÇ      created_at: timestamp
‚îÇ    }
‚îÇ 7. Envia WhatsApp   ‚îÇ ‚Üê Evolution API (custo R$ 0!)
‚îÇ    Template:
‚îÇ    "üîê Seu c√≥digo {APP_NAME}:\n\n*{OTP}*\n\nV√°lido por {TTL} minutos."
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ Response:
       ‚îÇ {
       ‚îÇ   "enviado": true,
       ‚îÇ   "numero": "5548988612609",
       ‚îÇ   "metodo": "whatsapp",
       ‚îÇ   "expira_em": "2025-10-28T23:05:00Z",
       ‚îÇ   "tentativas_restantes": 3
       ‚îÇ }
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   WhatsApp User     ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ üì± Recebe mensagem: ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ üîê Seu c√≥digo       ‚îÇ
‚îÇ MeuApp:             ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ *123456*            ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ V√°lido por 5        ‚îÇ
‚îÇ minutos.            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ Usu√°rio digita c√≥digo no app
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Dev App           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ POST /phone/otp/verify
       ‚îÇ {
       ‚îÇ   "numero": "5548988612609",
       ‚îÇ   "code": "123456"
       ‚îÇ }
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Retech Core API    ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ 1. Busca Redis      ‚îÇ ‚Üê GET phone:otp:{numero}
‚îÇ 2. Valida c√≥digo    ‚îÇ ‚Üê Compara code
‚îÇ 3. Checa expirado   ‚îÇ ‚Üê TTL Redis
‚îÇ 4. Checa usado      ‚îÇ ‚Üê used == false
‚îÇ 5. Incrementa       ‚îÇ ‚Üê attempts++ (m√°x 5)
‚îÇ    tentativas       ‚îÇ
‚îÇ 6. Se correto:      ‚îÇ
‚îÇ    - Marca usado    ‚îÇ ‚Üê used = true
‚îÇ    - Deleta Redis   ‚îÇ ‚Üê DEL phone:otp:{numero}
‚îÇ    - Log sucesso    ‚îÇ
‚îÇ    - Webhook (opt)  ‚îÇ ‚Üê POST {dev_webhook_url}
‚îÇ 7. Se errado:       ‚îÇ
‚îÇ    - Retorna erro   ‚îÇ
‚îÇ    - Mant√©m OTP     ‚îÇ
‚îÇ 8. Response         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îÇ Response (sucesso):
       ‚îÇ {
       ‚îÇ   "valido": true,
       ‚îÇ   "numero": "5548988612609",
       ‚îÇ   "verificado_em": "2025-10-28T22:45:00Z"
       ‚îÇ }
       ‚îÇ
       ‚îÇ Response (erro):
       ‚îÇ {
       ‚îÇ   "valido": false,
       ‚îÇ   "erro": "C√≥digo incorreto",
       ‚îÇ   "tentativas_restantes": 2
       ‚îÇ }
```

**Features WhatsApp OTP:**
- [x] **Custo ZERO** (Evolution API auto-hospedada)
- [x] **Taxa de abertura 98%** (vs 20% SMS)
- [x] **Customiza√ß√£o:** Templates configur√°veis por tenant
- [x] **Seguran√ßa:**
  - Rate limit: 3 OTPs/5min por n√∫mero (anti-spam)
  - Rate limit: Quota mensal por plano (100/1k/10k)
  - M√°x 5 tentativas de verifica√ß√£o por OTP
  - C√≥digo expira (TTL configur√°vel: 5-30 min)
  - Marca como usado (n√£o reutiliz√°vel)
- [x] **Webhook:** Notifica√ß√£o quando OTP validado (opcional)
- [x] **Logs:** Auditoria completa (envio, tentativas, verifica√ß√£o)

**Configura√ß√µes (Painel do Dev):**
```json
{
  "otp": {
    "ttl": 300,              // Segundos (5 min padr√£o)
    "digits": 6,             // Tamanho do c√≥digo
    "max_attempts": 5,       // Tentativas de verifica√ß√£o
    "rate_limit_window": 300, // Janela rate limit (5 min)
    "rate_limit_max": 3,     // M√°x OTPs na janela
    "template": "default",   // ou "custom"
    "custom_template": "Seu c√≥digo √©: {OTP}",
    "webhook_url": "https://seuapp.com/otp/verified", // opcional
    "app_name": "Meu App"    // Nome no template
  }
}
```

**Quotas por Plano:**
```
FREE:     100 OTPs/m√™s
BASIC:    1.000 OTPs/m√™s  (R$ 29/m√™s)
PRO:      10.000 OTPs/m√™s (R$ 99/m√™s)
BUSINESS: Ilimitado       (R$ 299/m√™s)
```

**Endpoints Completos:**
```
GET  /phone/:numero           - Validar + WhatsApp check
POST /phone/otp/send          - Enviar OTP via WhatsApp
POST /phone/otp/verify        - Verificar c√≥digo OTP
GET  /phone/otp/status/:numero - Status do OTP (dev only)
```

#### **üí° An√°lise do Fluxo (Opini√£o T√©cnica):**

**‚úÖ PONTOS FORTES:**
- Fluxo simples e direto (dev-friendly)
- Expira√ß√£o configur√°vel (flex√≠vel)
- Valida√ß√£o de uso √∫nico (seguran√ßa)
- WhatsApp (alta taxa de abertura)
- Custo ZERO (Evolution pr√≥pria)

**‚ö†Ô∏è MELHORIAS SUGERIDAS:**

1. **Rate Limiting Duplo:**
   - Por n√∫mero: 3 OTPs/5min (evita spam ao usu√°rio)
   - Por tenant: Quota mensal (evita abuso do servi√ßo)

2. **Tentativas Limitadas:**
   - M√°x 5 tentativas de verifica√ß√£o por OTP
   - Ap√≥s 5 falhas, bloquear e exigir novo OTP

3. **Webhook de Confirma√ß√£o:**
   - Dev pode receber POST quando OTP validado
   - Payload: `{ numero, verificado_em, tenant_id }`
   - Evita polling constante

4. **Templates Customiz√°veis:**
   - Vari√°veis: `{APP_NAME}`, `{OTP}`, `{TTL}`
   - Exemplo: "Seu c√≥digo {APP_NAME} √©: {OTP}"
   - Configur√°vel no painel do dev

5. **M√∫ltiplos Tamanhos de OTP:**
   - Configur√°vel: 4, 6, 8 d√≠gitos
   - Padr√£o: 6 d√≠gitos
   - Ajust√°vel por n√≠vel de seguran√ßa

6. **Logs de Auditoria:**
   - Registrar envio, tentativas, verifica√ß√£o
   - Dashboard: quantos OTPs enviados/verificados
   - Alertas: quota pr√≥xima do limite

**üö® RISCOS E MITIGA√á√ïES:**

**Risco 1: Banimento WhatsApp**
- Problema: WhatsApp pode banir n√∫mero por spam
- Limite: ~1.000 msgs/dia por n√∫mero
- Solu√ß√£o:
  - Usar m√∫ltiplas inst√¢ncias Evolution (rota√ß√£o)
  - Rate limit de 500 OTPs/dia por inst√¢ncia
  - Monitoramento de health (QR Code v√°lido?)
  - Alertas de desconex√£o

**Risco 2: Confiabilidade Evolution**
- Problema: Evolution depende de conex√£o WhatsApp est√°vel
- Solu√ß√£o:
  - Health check a cada 5 min
  - Reconectar automaticamente se cair
  - Fallback opcional para SMS (se dev configurar gateway pr√≥prio)

**Risco 3: LGPD/Compliance**
- Problema: WhatsApp Business Terms + LGPD
- Solu√ß√£o:
  - Opt-in obrigat√≥rio (documentar no cadastro)
  - Permitir opt-out
  - Logs de consentimento
  - N√£o enviar marketing (s√≥ OTP)

#### **üîß Implementa√ß√£o T√©cnica:**

**Arquivos Principais:**
```
Backend:
- internal/http/handlers/phone.go          (handler principal)
- internal/services/evolution_client.go    (client Evolution API)
- internal/services/otp_service.go         (l√≥gica OTP)
- internal/http/router.go                  (rotas)
- internal/domain/settings.go              (config OTP)
- internal/auth/scope_middleware.go        (scope "phone")

Frontend:
- app/ferramentas/validar-telefone/page.tsx (ferramenta p√∫blica)
- app/painel/docs/page.tsx                  (docs dev)
- components/otp-config.tsx                 (config painel dev)

Docs:
- internal/docs/openapi.yaml               (Redoc)
```

**Dependencies:**
```go
// Evolution API Client
type EvolutionClient struct {
    BaseURL  string
    APIKey   string
    Instance string
}

// OTP Service
type OTPService struct {
    Redis    *redis.Client
    Evolution *EvolutionClient
    Config   OTPConfig
}
```

**Tempo Estimado:**
- WhatsApp Validator: 3-4 horas
- WhatsApp OTP: 5-6 horas
- Testes + Docs: 2-3 horas
- **Total: 10-13 horas** (~2 dias)

#### **üìä Diferencial Competitivo:**

**O que concorrentes oferecem:**
- Twilio: SMS ($0,08/msg) + WhatsApp Business API ($$$)
- Zenvia: SMS (R$ 0,10/msg) + WhatsApp caro
- NumVerify: Valida√ß√£o b√°sica (sem WhatsApp)
- AbstractAPI: Valida√ß√£o b√°sica (sem WhatsApp)

**O que N√ìS oferecemos:**
- ‚úÖ WhatsApp Validator (100% preciso, custo R$ 0)
- ‚úÖ WhatsApp OTP (98% abertura, custo R$ 0)
- ‚úÖ Valida√ß√£o formato ANATEL (95-98% preciso)
- ‚úÖ DDD ‚Üí Cidades (100% preciso, BrasilAPI)
- ‚úÖ Tipo mobile/fixo (99%+ preciso)
- ‚úÖ Cache 3 camadas (performance)
- ‚úÖ Planos acess√≠veis (R$ 29-299/m√™s vs $100+/m√™s)

**üî• Diferencial √öNICO:**
> "√önica API brasileira com WhatsApp Verification real e OTP por WhatsApp sem custo adicional por mensagem!"

#### **‚ùå O que N√ÉO vamos implementar (e por qu√™):**

**1. Operadora Exata:**
- Problema: Portabilidade invalida heur√≠stica
- Precis√£o: ~60% (muito baixa)
- Solu√ß√£o real: API paga (R$ 0,01/req) ou base ANATEL (80%)
- Decis√£o: **N√ÉO implementar agora**

**2. HLR Lookup (n√∫mero ativo?):**
- Problema: Requer acesso a operadoras
- Custo: R$ 0,01-0,05/consulta
- Decis√£o: **Avaliar demanda futura**

**3. SMS OTP:**
- Problema: Custo alto (R$ 0,10-0,20/msg)
- Concorr√™ncia: Twilio/Zenvia j√° fazem
- Decis√£o: **Apenas WhatsApp** (diferencial)

#### **Fontes de Dados:**

**‚úÖ CONFI√ÅVEIS (100%):**
- BrasilAPI (DDD ‚Üí Cidades)
- Evolution API (WhatsApp verification)
- Regras ANATEL (formato, tipo)

**‚ö†Ô∏è PARCIAIS (80%):**
- Base ANATEL prefixos (sem portabilidade)

**‚ùå N√ÉO CONFI√ÅVEIS (60%):**
- Heur√≠stica operadora (√∫ltimo d√≠gito)
- Tabelas desatualizadas

**Decis√£o:** Usar apenas fontes 100% confi√°veis!

#### **üéØ Status:**
- [ ] Planejado
- [ ] Documentado (este arquivo)
- [ ] Aguardando implementa√ß√£o

**Prazo:** 2-3 dias ap√≥s aprova√ß√£o  
**Prioridade:** M√©dia-Alta (diferencial √∫nico)

---

**Prazo:** 3 meses  
**Prioridade:** Alta (APIs mais demandadas)

---

## üü£ FASE 3 - EXPANS√ÉO E COMPLIANCE (3-6 MESES)

**Meta:** 17 APIs | **Status:** Planejado

### **üìã Dados Cadastrais**
- [ ] **CPF**: Valida√ß√£o de d√≠gitos + consulta Receita Federal
- [ ] **Email**: Valida√ß√£o real (n√£o s√≥ regex)
- [ ] **Telefone**: Valida√ß√£o + operadora
- [ ] **Operadora**: Identifica√ß√£o + portabilidade

### **üßæ Valida√ß√£o Fiscal e Compliance** üÜï

#### **APIs P√∫blicas (qualquer CNPJ):**
- [ ] **NF-e Validation**: Consulta NF-e por chave de 44 d√≠gitos
  - Fonte: Webservice SEFAZ (gratuito e p√∫blico)
  - Dados: emitente, destinat√°rio, valor, status
  - Cache: 30 dias (NF-e n√£o muda)
  - Performance: ~500ms
  - **Casos de uso:** Valida√ß√£o de fornecedores, e-commerce, contabilidade

- [ ] **Certid√µes (CND/CNDT)**: Consulta certid√µes negativas de d√©bitos
  - CND Federal (Receita Federal)
  - CNDT (D√©bitos Trabalhistas - TST)
  - Status: Regular/Irregular
  - Fonte: TST + Receita (gratuito via scraping)
  - Cache: 1 dia
  - **Casos de uso:** Due diligence, pr√©-contrata√ß√£o, licita√ß√µes

- [ ] **Compras Governamentais**: Licita√ß√µes e contratos por CNPJ
  - Fonte: Portal da Transpar√™ncia + ComprasNet (APIs p√∫blicas)
  - Dados: licita√ß√µes vencidas, contratos, valores
  - Cache: 7 dias
  - Custo: Gratuito
  - **Casos de uso:** Intelig√™ncia comercial, due diligence

#### **Dados do Pr√≥prio Cliente (com autoriza√ß√£o):** üî• üÜï
- [ ] **Meus Documentos Fiscais**: NF-e auto-sync do cliente
  - Cliente envia certificado digital A1
  - Sync autom√°tico di√°rio (e-CAC/SEFAZ)
  - NF-e emitidas + recebidas (√∫ltimos 12 meses)
  - Download XML/PDF (DANFE)
  - Analytics: volume, valor, top fornecedores/clientes
  - **Diferencial:** Dashboard fiscal unificado
  - **Plano:** Business (R$ 99/m√™s)

- [ ] **Meus Boletos**: Open Finance integrado üè¶
  - Cliente autoriza via OAuth 2.0
  - Conex√£o com m√∫ltiplos bancos
  - Boletos a pagar + a receber
  - Alertas de vencimento
  - Proje√ß√£o de cash flow
  - **Diferencial:** Dashboard financeiro unificado
  - **Plano:** Enterprise (R$ 299/m√™s)
  - **Prazo:** Requer homologa√ß√£o BACEN (3-4 meses)

### **üó∫Ô∏è Geografia Avan√ßada**
- [ ] **Bairros**: Lista por cidade
- [ ] **Coordenadas**: Lat/Long por CEP
- [ ] **Dist√¢ncia**: C√°lculo entre CEPs

### **üí∞ Financeiro**
- [ ] **SELIC/CDI/IPCA**: Taxas oficiais Banco Central
- [ ] **Indicadores**: Hist√≥rico e proje√ß√µes

### **üöö Log√≠stica**
- [ ] **Frete**: C√°lculo Correios + transportadoras
- [ ] **Rastreamento**: C√≥digo Correios
- [ ] **Ve√≠culos**: Consulta por placa (DENATRAN)

**Prazo:** 3 meses  
**Prioridade:** Alta (NF-e e Certid√µes) / M√©dia (demais)

---

## üü° FASE 4 - DADOS AVAN√áADOS E COMPLIANCE (6-9 MESES)

**Meta:** 7 APIs | **Status:** Planejado

### **‚öñÔ∏è Compliance e Risco** üÜï
- [ ] **Protestos**: T√≠tulos protestados por CNPJ
  - Fonte: Serasa (pago R$ 1,50/req) OU Web scraping cart√≥rios (gratuito)
  - Dados: total protestos, valores, datas, cart√≥rios
  - Cache: 7 dias
  - **Decis√£o:** Avaliar demanda antes de contratar API paga
  - **Casos de uso:** An√°lise de cr√©dito, due diligence, risk assessment

- [ ] **Score de Cr√©dito**: An√°lise de risco empresarial (futuro)
  - Agrega√ß√£o de dados: CNPJ, Certid√µes, Protestos, Compras Gov
  - Score propriet√°rio (0-1000)
  - Indicadores de risco

### **üèõÔ∏è Dados Governamentais**
- [ ] **Judicial**: Processos p√∫blicos (PJe + TJs)
- [ ] **CEIS/CNEP**: Empresas inid√¥neas
- [ ] **Simples Nacional**: Consulta optantes
- [ ] **PEP**: Pessoas Politicamente Expostas

**Fonte:** Portais p√∫blicos do governo  
**M√©todo:** Scraping + cache local  
**Prazo:** 3 meses  
**Prioridade:** Baixa (nicho espec√≠fico)

---

## üöÄ **INFRAESTRUTURA & PERFORMANCE (PLANEJADO)** üÜï

### **Migra√ß√£o Oracle Cloud (S√£o Paulo)** üéØ
**Objetivo:** Reduzir lat√™ncia de 160ms para 5-15ms

**Status:** Pesquisa conclu√≠da ‚úÖ | Automa√ß√£o planejada üìù

#### **Por que Oracle Cloud?**
- ‚úÖ **Regi√£o S√£o Paulo dispon√≠vel** (sa-saopaulo-1)
- ‚úÖ **Always Free Tier** (GRATUITO para sempre)
- ‚úÖ **Lat√™ncia:** 5-15ms (vs 150-200ms Railway EUA)
- ‚úÖ **Recursos generosos:** 4 vCPUs ARM + 24GB RAM
- ‚úÖ **200GB Storage gratuito**
- ‚úÖ **10TB bandwidth/m√™s**
- ‚úÖ **Load Balancer inclu√≠do**

#### **Automa√ß√£o Via CLI** üîß
- [ ] **Script de Provisionamento** (`scripts/oracle/01-provision.sh`)
  - [ ] Criar VM (4 cores ARM, 24GB RAM, regi√£o SP)
  - [ ] Configurar VCN + Subnet + Security Lists
  - [ ] Instalar Docker + Docker Compose
  - [ ] Setup usu√°rio deploy + SSH
  - [ ] Verifica√ß√£o de custos (R$ 0,00 se free tier)

- [ ] **Script de Deploy** (`scripts/oracle/02-deploy.sh`)
  - [ ] Subir Redis (via Docker Hub)
  - [ ] Subir MongoDB (via Docker Hub)
  - [ ] Subir aplica√ß√£o backend
  - [ ] Configurar vari√°veis de ambiente
  - [ ] Setup volumes persistentes (200GB)

- [ ] **CI/CD Autom√°tico** (`.github/workflows/deploy-oci.yml`)
  - [ ] Integra√ß√£o com GitHub (branch: main)
  - [ ] Deploy autom√°tico em push
  - [ ] Rollback autom√°tico em erro
  - [ ] Notifica√ß√µes Slack/Discord

- [ ] **Monitoramento** (`scripts/oracle/monitoring-setup.sh`)
  - [ ] Logs centralizados (OCI Logging)
  - [ ] M√©tricas (CPU, RAM, Disco)
  - [ ] Alertas (CPU >80%, RAM >90%, Disco >85%)
  - [ ] Dashboard de sa√∫de

- [ ] **Escalabilidade** (`scripts/oracle/scale-up.sh`)
  - [ ] Aumentar vCPU via script
  - [ ] Aumentar RAM via script
  - [ ] Adicionar storage via script
  - [ ] Load balancer setup

#### **Compara√ß√£o Railway vs Oracle**
| Item | Railway (Atual) | Oracle Free | Oracle Pago |
|------|----------------|-------------|-------------|
| **Regi√£o** | EUA (us-west) | BR (S√£o Paulo) | BR (S√£o Paulo) |
| **Lat√™ncia** | 150-200ms | 5-15ms üöÄ | 5-15ms üöÄ |
| **vCPU** | ~0.5 | 4 cores ARM | 4-64 cores |
| **RAM** | ~512MB | 24GB | 24-512GB |
| **Storage** | ~1GB | 200GB | Ilimitado |
| **Bandwidth** | ~100GB | 10TB | Ilimitado |
| **Custo** | ~$5-10/m√™s | **R$ 0/m√™s** ‚úÖ | R$ 130-500/m√™s |

#### **Resultado Esperado**
```
Performance com cache Redis + Servidor BR:
‚îú‚îÄ 1¬™ request: ~50ms (vs 200ms atual) ‚Üí 4x mais r√°pido
‚îú‚îÄ 2¬™+ request: ~1-5ms (vs 160ms atual) ‚Üí 32x mais r√°pido
‚îî‚îÄ Competitivo com Brasil API (31ms)
```

**Prazo:** 1-2 semanas  
**Prioridade:** Alta (diferencial competitivo)  
**Documenta√ß√£o:** `/docs/ORACLE_CLOUD_RESEARCH.md`

---

## ‚ö™ FUTURO (9-12 MESES)

**Meta:** 6 APIs | **Status:** Backlog

### **Recursos Avan√ßados**
- [ ] **Ruas**: Autocomplete de endere√ßos
- [ ] **Demografia**: Popula√ß√£o, IDH, PIB
- [ ] **NF-e**: Valida√ß√£o de chave
- [ ] **Inscri√ß√£o Estadual**: Valida√ß√£o por UF
- [ ] **Boletos**: Gera√ß√£o c√≥digo de barras
- [ ] **Pix**: QR Code est√°tico
- [ ] **Dias √öteis**: C√°lculo entre datas
- [ ] **Fusos**: Hor√°rios por cidade

**Prazo:** 3 meses  
**Prioridade:** Baixa

---

## üìä RESUMO POR CATEGORIA

| Categoria | Total | Dispon√≠vel | Fase 2 | Fase 3 | Fase 4 | Futuro |
|-----------|-------|-----------|--------|--------|--------|--------|
| **üìã Cadastrais** | 7 | 0 | 1 | 4 | 0 | 2 |
| **üó∫Ô∏è Geografia** | 6 | 1 | 1 | 3 | 0 | 1 |
| **üí∞ Financeiro** | 5 | 0 | 2 | 1 | 0 | 2 |
| **üöö Log√≠stica** | 4 | 0 | 1 | 3 | 0 | 0 |
| **üîß Utilidades** | 4 | 0 | 1 | 1 | 0 | 2 |
| **üèõÔ∏è Governo** | 5 | 0 | 0 | 0 | 5 | 0 |
| **TOTAL** | **31** | **1** | **6** | **13** | **5** | **6** |

---

## üéØ PR√ìXIMOS 30 DIAS

### **Semana 1-2: CEP + CNPJ**
1. Integrar ViaCEP
2. Implementar fallback Brasil API
3. Scraping Receita Federal (CNPJ)
4. Testes de carga

### **Semana 3: Moedas + Bancos**
1. Integrar API Banco Central
2. Carregar lista de bancos (STR)
3. Endpoints + cache

### **Semana 4: FIPE + Feriados**
1. Integrar FIPE API
2. Gerar calend√°rio de feriados
3. Documenta√ß√£o atualizada
4. Deploy e testes

---

## üìà CRONOGRAMA VISUAL

```
2025
‚îÇ
‚îú‚îÄ Out/Nov/Dez ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà Fase 2: Dados Essenciais
‚îÇ  ‚îî‚îÄ 6 APIs (CEP, CNPJ, Moedas, Bancos, FIPE, Feriados)
‚îÇ
‚îú‚îÄ Jan/Fev/Mar ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà Fase 3: Expans√£o
‚îÇ  ‚îî‚îÄ 13 APIs (CPF, Email, Telefone, Bairros, Frete, etc.)
‚îÇ
‚îú‚îÄ Abr/Mai/Jun ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà Fase 4: Compliance
‚îÇ  ‚îî‚îÄ 5 APIs (Judicial, Transpar√™ncia, CEIS, Simples, PEP)
‚îÇ
‚îî‚îÄ Jul/Ago/Set ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà Futuro
   ‚îî‚îÄ 6 APIs (Ruas, Demografia, NF-e, Boletos, Pix, etc.)
```

---

## üí° OBSERVA√á√ïES

### **Dados Gratuitos**
- Priorizar APIs p√∫blicas governamentais
- Uso de Brasil API como aggregator
- Banco Central, IBGE, FIPE (todas gratuitas)

### **Scraping**
- Apenas quando n√£o h√° API oficial
- Respeitar robots.txt
- Cache agressivo (reduzir requests)
- Exemplos: CNPJ (Receita Federal), Judicial (PJe)

### **Cache Strategy**
- **Est√°tico** (Geografia, Bancos): Permanente
- **Semi-est√°tico** (CEP, FIPE): 7 dias
- **Din√¢mico** (Moedas): 1 hora
- **Alta rotatividade** (Judicial): 24 horas

### **Escalabilidade**
- MongoDB indexado para performance
- Redis implementado para cache distribu√≠do ‚úÖ
- Rate limiting por tenant (j√° implementado)
- CDN para assets est√°ticos

---

## üéÆ **SEO & CONVERS√ÉO (IMPLEMENTADO)** ‚úÖ üÜï

### **Landing Page & Marketing**
- [x] Landing page com hero otimizado
- [x] Cards de APIs em destaque (CEP, CNPJ, GEO)
- [x] Roadmap visual com 36 APIs
- [x] Meta tags avan√ßadas (Open Graph, Twitter Cards)
- [x] Schema.org (Organization, Product, BreadcrumbList)
- [x] Sitemap din√¢mico (100+ p√°ginas)
- [x] Robots.txt otimizado
- [x] 14 keywords estrat√©gicas

### **Playground Interativo** ‚úÖ
- [x] **P√°gina:** `/playground`
- [x] Teste CEP, CNPJ e GEO **sem cadastro**
- [x] C√≥digo copy-paste (JavaScript, Python, PHP, cURL)
- [x] Response time display (~1-200ms)
- [x] Rotas p√∫blicas seguras (`/public/*`)
- [x] Sele√ß√£o autom√°tica da primeira API dispon√≠vel
- [x] Browser fingerprinting para seguran√ßa
- [x] Rate limiting por IP
- [x] **Diferencial:** NENHUM concorrente brasileiro tem isso
- [x] **Convers√£o esperada:** 10-15%

### **Ferramentas P√∫blicas** ‚úÖ
1. **CEP Checker** (`/ferramentas/consultar-cep`)
   - [x] Consulta gratuita e sem cadastro
   - [x] Share links funcionais
   - [x] Usa mesma API Key demo do playground
   - [x] Valida√ß√£o de scopes
   - [x] Target: 18.000 buscas/m√™s

2. **Buscar CEP** (`/ferramentas/buscar-cep`) üÜï
   - [x] Busca reversa: encontra CEP pelo endere√ßo
   - [x] Par√¢metros: UF, Cidade, Logradouro
   - [x] Retorna at√© 50 CEPs por busca
   - [x] Grid responsivo de resultados
   - [x] Badge "NOVO" na p√°gina inicial
   - [x] Usa mesma API Key demo do playground
   - [x] Target: 15.000 buscas/m√™s

3. **CNPJ Validator** (`/ferramentas/validar-cnpj`)
   - [x] Valida√ß√£o em tempo real
   - [x] Dados da Receita Federal
   - [x] Usa mesma API Key demo do playground
   - [x] Valida√ß√£o de scopes
   - [x] Target: 12.000 buscas/m√™s

### **Landing Pages de APIs** ‚úÖ
- [x] **`/apis/cep`** - Hero + Features + C√≥digo + Compara√ß√£o + FAQ
- [x] Tabela comparativa (Retech vs ViaCEP vs Brasil API)
- [x] Casos de uso (E-commerce, Marketplaces, Cadastros)
- [x] FAQ com Accordions (5 perguntas)
- [x] CTAs estrat√©gicos
- [x] Tempos de resposta realistas (~160ms)

### **SEO T√©cnico** ‚úÖ
- [x] Metadata din√¢mica por p√°gina
- [x] Canonical URLs
- [x] Alt text em imagens
- [x] Semantic HTML
- [x] Acessibilidade (ARIA)
- [x] Performance otimizada (Next.js 15)

---

## üìù √öLTIMAS ATUALIZA√á√ïES (Out/2025)

### **üìÖ 28 de Outubro de 2025** üÜï

#### **üîç Busca Reversa de CEP (Endere√ßo ‚Üí CEP)** ‚úÖ
- **Novo endpoint:** `GET /cep/buscar?uf=SP&cidade=S√£o+Paulo&logradouro=Paulista`
- **Endpoint p√∫blico:** `GET /public/cep/buscar` (para ferramentas/playground)
- **Integra√ß√£o:** ViaCEP (busca por endere√ßo)
- **Cache 3 camadas:**
  - Redis L1 (~1ms)
  - MongoDB L2 (~10ms)  
  - ViaCEP L3 (~100ms)
- **Retorno:** Array de at√© 50 CEPs por busca
- **Valida√ß√µes:**
  - UF: 2 caracteres
  - Cidade e Logradouro: m√≠nimo 3 caracteres
- **Features:**
  - Cache normalizado (search:UF:cidade:logradouro)
  - Promo√ß√£o autom√°tica Redis ‚Üí MongoDB
  - TTL configur√°vel (mesmo do CEP normal)
  - Graceful degradation
- **Frontend:**
  - Nova ferramenta: `/ferramentas/buscar-cep`
  - Grid responsivo de resultados (at√© 50 cards)
  - Badge "NOVO" na landing page
  - Bot√£o copiar CEP
  - Integrado com playground
- **Performance:**
  - 1¬™ busca: ~100ms (ViaCEP)
  - 2¬™+ busca: ~1-10ms (cache)
- **Use cases:**
  - Autocomplete de endere√ßos
  - Valida√ß√£o de formul√°rios
  - Preenchimento autom√°tico de CEP
  - Busca quando usu√°rio n√£o sabe o CEP

### **üìÖ 27 de Outubro de 2025** üÜï

#### **üî¥ Redis Cache (L1) - Sistema Completo** ‚úÖ
- Cache em mem√≥ria para m√°xima performance (~1ms)
- Conex√£o via `REDIS_URL` (Railway/Oracle)
- Graceful degradation (se cair, usa MongoDB)
- Keys separadas: `cep:*`, `cnpj:*`, `geo:*`
- TTL: 24h para hot data
- **Admin Dashboard:**
  - Stats: total keys, keys por servi√ßo (CEP, CNPJ, GEO)
  - Mem√≥ria usada (MB)
  - Status de conex√£o (üü¢/üî¥)
  - Bot√£o "Limpar Todo Redis" com confirma√ß√£o
  - Explica√ß√£o do fluxo L1‚ÜíL2‚ÜíL3

#### **üîß Cache Independente (CEP + CNPJ)** ‚úÖ
- Controles 100% independentes por servi√ßo
- Cada servi√ßo tem seu pr√≥prio:
  - Toggle enable/disable
  - TTL (1-365 dias)
  - AutoCleanup (MongoDB TTL Index)
  - Stats em tempo real
  - Bot√£o de limpeza manual
- **Cards renomeados:**
  - "MongoDB Cache - CEP (L2)"
  - "MongoDB Cache - CNPJ (L2)"
- Migra√ß√£o autom√°tica de estrutura antiga
- Tudo salvando corretamente ‚úÖ

#### **üîí Seguran√ßa API Key Refor√ßada** ‚úÖ
- API Key oculta no frontend (üîí ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢)
- Removidos fallbacks inseguros
- `APIKEY_HASH_SECRET` obrigat√≥rio
- Panic se vari√°vel n√£o configurada
- Secret forte gerado (256 bits base64)
- Bot√µes "Gerar Nova" e "Rotacionar"
- Auto-rota√ß√£o ao mudar scopes

#### **üìä Analytics com Timezone Brasil** ‚úÖ
- Timezone: America/Sao_Paulo (todas as datas)
- Requests "Hoje" vs "Ontem" corretos
- Formata√ß√£o pt-BR (27 de outubro de 2025)
- Gr√°ficos com dias mais recentes primeiro
- Sem mais dados de datas futuras

#### **üéÆ Playground Multi-Camada** ‚úÖ
- Rate limiting por IP (configur√°vel)
- Rate limiting global (shared)
- Browser fingerprinting (WebGL, Canvas, Audio)
- Valida√ß√£o de scopes (cep, cnpj, geo)
- Sele√ß√£o autom√°tica da primeira API
- Ferramentas integradas (mesmo API Key demo)

#### **üîç Pesquisa Oracle Cloud** ‚úÖ
- Regi√£o S√£o Paulo dispon√≠vel
- Always Free Tier mapeado
- Automa√ß√£o via OCI CLI planejada
- Scripts de provisionamento desenhados
- Estimativa: R$ 0/m√™s (free) ou R$ 130-500/m√™s (expans√£o)
- Lat√™ncia esperada: 5-15ms (vs 160ms atual)

#### **üè• Health Check Melhorado** ‚úÖ
- Status REAL de MongoDB e Redis
- Uptime desde startup
- Vers√£o da API
- Auto-refresh 30s no frontend
- Estados visuais (üü¢ Operacional, üü° Degradado, üî¥ Indispon√≠vel)
- Graceful degradation (Redis down n√£o afeta status geral)

#### **üé® UX Final** ‚úÖ
- Performance corrigida em todas as p√°ginas
- Env `NEXT_PUBLIC_DOCS_URL` (links din√¢micos)
- Hero "The Retech Core"
- Rodap√© completo (Alan Rezende, Florian√≥polis, WhatsApp)
- 6 p√°ginas novas:
  - `/precos` - Planos + Status da plataforma
  - `/sobre` - Hist√≥ria + Fundador + Miss√£o
  - `/contato` - Formul√°rio ‚Üí WhatsApp
  - `/status` - Health check real (30s refresh)
  - `/legal/termos` - LGPD compliant
  - `/legal/privacidade` - LGPD compliant

---

### **üìÖ 24 de Outubro de 2025**

#### **‚úÖ API CEP Implementada**
- Endpoint `/cep/:codigo` funcional
- Cache com ViaCEP + Brasil API (fallback)
- Performance: 95% das requests em <10ms (cache)
- Normaliza√ß√£o autom√°tica de formato

#### **‚úÖ API CNPJ Implementada**
- Endpoint `/cnpj/:numero` funcional
- Brasil API + ReceitaWS (fallback)
- Valida√ß√£o de d√≠gito verificador
- QSA (Quadro de S√≥cios e Administradores)
- CNAEs completos (principal + secund√°rios)
- Endere√ßo + contatos + capital social
- Cache 30 dias (otimizado para empresas)
- Performance: ~10ms (cache) / ~200ms (Brasil API)

#### **‚úÖ Sistema de Cache Configur√°vel**
- Admin pode ajustar TTL (1-365 dias)
- Toggle enable/disable por servi√ßo
- Limpeza autom√°tica (MongoDB TTL Index)
- Limpeza manual com AlertDialog
- Stats em tempo real (total cached, recent 24h)
- Suporte para CEP e CNPJ

#### **‚úÖ Settings Completas**
- Contato/Vendas (WhatsApp din√¢mico)
- Cache configur√°vel por API
- Migration autom√°tica de schemas antigos
- Bug fix: contact e cache agora salvam corretamente
- Todas as configs persistem entre reloads

#### **‚úÖ Melhorias de UX**
- AlertDialog para confirma√ß√µes cr√≠ticas
- Auto-refresh de m√©tricas
- Tratamento de erros aprimorado
- Feedback visual em todas as a√ß√µes
- Landing page com 3 APIs em destaque

---

## üéÅ DIFERENCIAIS COMPETITIVOS

‚úÖ **Hub Completo** - 36 APIs essenciais, 1 chave √∫nica  
‚úÖ **Ultra Performance** - ~1ms (Redis L1) / ~10ms (MongoDB L2) / ~160ms (API L3)  
‚úÖ **Confi√°vel** - 3 camadas de cache + fallback autom√°tico + graceful degradation + 99.9% uptime  
‚úÖ **Gratuito** - 1.000 requests/dia sem cart√£o de cr√©dito  
‚úÖ **Profissional** - Dashboard completo + Redoc + Analytics em tempo real + Timezone BR  
‚úÖ **Transparente** - Dashboard com m√©tricas em tempo real + Activity logs  
‚úÖ **Configur√°vel** - Admin controla cache (independente), rate limits, CORS, JWT, playground  
‚úÖ **Seguro** - API Keys com HMAC-SHA256 + Scopes granulares + Rate limiting multi-camada  
‚úÖ **Playground P√∫blico** - Teste sem cadastro + Browser fingerprinting + Ferramentas gratuitas  
‚úÖ **SEO Otimizado** - Meta tags + Sitemap + Schema.org + 14 keywords estrat√©gicas  
‚úÖ **Oracle Cloud Ready** - Migra√ß√£o planejada para lat√™ncia <15ms (servidor BR)

---

## üéØ PR√ìXIMOS PASSOS

### **Imediato (Esta Semana)** üî•
1. **Deploy com `APIKEY_HASH_SECRET`** (Seguran√ßa)
   - Adicionar vari√°vel no Railway
   - Testar playground em produ√ß√£o
   - Confirmar API Keys demo funcionando

2. **Testes de Carga**
   - Validar Redis cache em produ√ß√£o
   - Monitorar hit rate (L1, L2, L3)
   - Otimizar TTLs se necess√°rio

### **Curto Prazo (2-4 Semanas)** üöÄ
1. **Migra√ß√£o Oracle Cloud** (Performance)
   - Criar conta Oracle Cloud (regi√£o SP)
   - Desenvolver scripts de automa√ß√£o
   - Setup CI/CD com GitHub Actions
   - Testar lat√™ncia (meta: <15ms)
   - Migra√ß√£o gradual (staging ‚Üí produ√ß√£o)

2. **Moedas API** (Fase 2)
   - Banco Central API
   - Cota√ß√µes real-time
   - Hist√≥rico 30 dias

3. **Bancos API** (Fase 2)
   - Dados STR Banco Central
   - Cache permanente
   - Lista completa COMPE/ISPB

### **M√©dio Prazo (1-3 Meses)** üìä
1. **FIPE API** (Fase 2)
   - Tabela FIPE
   - Pre√ßos de ve√≠culos
   - Cache 7 dias

2. **Feriados API** (Fase 2)
   - Nacionais + Estaduais
   - Ponto facultativo

3. **NF-e Validation** (Fase 3 - Alta demanda)
   - Webservice SEFAZ
   - Valida√ß√£o de chave 44 d√≠gitos

---

## üÜï ATUALIZA√á√ïES RECENTES

### **üìÖ 24 de Outubro de 2025 - Manh√£**

### **üè¢ API CNPJ Implementada** ‚úÖ
- GET /cnpj/:numero completo
- Brasil API + ReceitaWS fallback
- Cache 30 dias configur√°vel
- Valida√ß√£o CNPJ + normaliza√ß√£o
- Admin settings completo
- 100% funcional e testado

### **üîí Sistema de Scopes Completo** ‚úÖ
- Scopes granulares: `geo`, `cep`, `cnpj`, `all`
- Prote√ß√£o em todas as rotas p√∫blicas
- Valida√ß√£o autom√°tica de permiss√µes
- Frontend com sele√ß√£o visual (checkboxes)
- Backend retrocompat√≠vel (aceita `geo:read` e `geo`)
- Documenta√ß√£o completa em `docs/SCOPES_ANALYSIS.md`

### **‚öôÔ∏è Admin Settings Aprimorado** ‚úÖ
- Cache CEP: TTL configur√°vel (1-365 dias)
- Cache CNPJ: TTL configur√°vel (1-365 dias)
- Stats de cache em tempo real
- Limpeza manual com AlertDialog
- Valida√ß√£o de inputs (onBlur)
- Auto-cleanup via TTL index MongoDB

### **üêõ Corre√ß√µes de Bugs** ‚úÖ
- TTL inputs agora aceitam campo vazio durante digita√ß√£o
- Cache normalizando CEP/CNPJ antes de salvar
- Settings salvando `contact` e `cache` corretamente
- Upsert habilitado em cache (cria se n√£o existir)

### **üìö Documenta√ß√£o** ‚úÖ
- `SCOPES_ANALYSIS.md` - An√°lise completa do sistema
- `SCOPES_SYSTEM.md` - Guia de uso atualizado
- `CHECKLIST_POS_IMPLEMENTACAO.md` - Processo padronizado
- Redoc atualizado com CNPJ

---

### **üìÖ 24 de Outubro de 2025 - Noite/Madrugada** üåô

### **üöÄ Estrat√©gia Completa de SEO Implementada** ‚úÖ
- Meta tags avan√ßadas (Open Graph, Twitter Cards, Schema.org)
- Sitemap din√¢mico com 100+ p√°ginas
- Robots.txt otimizado
- 14 keywords estrat√©gicas
- Build passando em produ√ß√£o

### **üéÆ API Playground Interativo** ‚úÖ
- Teste CEP, CNPJ e Geografia **sem cadastro**
- C√≥digo copy-paste (JavaScript, Python, PHP, cURL)
- Response time display (~5-200ms)
- Rotas p√∫blicas (`/public/*`) implementadas
- **Diferencial:** NENHUM concorrente brasileiro tem isso
- **Convers√£o esperada:** 10-15%

### **üîß Ferramentas P√∫blicas (2)** ‚úÖ
1. **CEP Checker** (`/ferramentas/consultar-cep`)
   - Target: 18.000 buscas/m√™s
   - Consulta gratuita e ilimitada
   - Share links funcionais

2. **CNPJ Validator** (`/ferramentas/validar-cnpj`)
   - Target: 12.000 buscas/m√™s
   - Valida√ß√£o em tempo real
   - Dados da Receita Federal

### **üìÑ Landing Page API CEP** ‚úÖ
- Hero + Features + C√≥digo + Compara√ß√£o
- Tabela comparativa (Retech vs ViaCEP vs Brasil API)
- Casos de uso (E-commerce, Marketplaces, Cadastros, An√°lise)
- FAQ com Accordions (5 perguntas)
- CTAs estrat√©gicos

### **üÜï Novas APIs Planejadas** ‚úÖ
- **NF-e Validation** (Fase 3 - Alta prioridade)
- **Certid√µes CND/CNDT** (Fase 3 - Alta prioridade)
- **Compras Governamentais** (Fase 3 - M√©dia prioridade)
- **Protestos** (Fase 4 - Avaliar demanda)
- **Score de Cr√©dito** (Fase 4 - Futuro)
- Documenta√ß√£o: `NOVAS_APIS_BOLETOS_NFE.md`

### **üìä Impacto SEO** ‚úÖ
- 3.000+ linhas de c√≥digo
- 18 arquivos criados
- Keywords-alvo: 50k+ buscas/m√™s
- Expectativa: 5.000+ visitas/m√™s (m√™s 3)

---

## üìö **DOCUMENTA√á√ÉO T√âCNICA**

### **Arquitetura & Infraestrutura**
- `/docs/ORACLE_CLOUD_RESEARCH.md` - Pesquisa completa Oracle Cloud + Scripts CLI
- `/build/docker-compose.yml` - Compose local (MongoDB + Redis + API)
- `/internal/bootstrap/indexes.go` - Indexes MongoDB (auto-cria√ß√£o no startup)

### **Cache & Performance**
- **Redis L1:** Implementado em `internal/cache/redis_client.go`
- **MongoDB L2:** Implementado nos handlers (CEP, CNPJ)
- **Graceful Degradation:** Redis cai ‚Üí MongoDB funciona
- **Admin Dashboard:** Cards independentes (Redis, CEP, CNPJ)
- **Migra√ß√£o Autom√°tica:** Estrutura antiga ‚Üí nova (transparente)

### **Seguran√ßa**
- **API Keys:** HMAC-SHA256 com `APIKEY_HASH_SECRET` obrigat√≥rio
- **Scopes:** Granulares (`cep`, `cnpj`, `geo`, `all`)
- **Rate Limiting:** Multi-camada (Tenant, IP, Global)
- **Browser Fingerprinting:** WebGL, Canvas, Audio (sem travar UI)
- **CORS:** Configur√°vel via admin (strict mode)
- **JWT:** TTL din√¢mico (Access: 15min, Refresh: 7 dias)

### **Analytics & Logs**
- **Timezone:** America/Sao_Paulo (todas as datas)
- **Activity Logs:** Auditoria completa (login, API keys, settings)
- **Usage Tracking:** Por dia, tenant, endpoint
- **Metrics Dashboard:** Auto-refresh 30s, gr√°ficos 30 dias

### **Frontend**
- **Admin Portal:** Dashboard, Tenants, API Keys, Settings, Analytics
- **Developer Portal:** Dashboard, Usage, API Keys, Docs
- **Public Pages:** Landing, Playground, Ferramentas, APIs
- **SEO:** Meta tags, Sitemap, Schema.org, Open Graph

---

## üîß **VARI√ÅVEIS DE AMBIENTE NECESS√ÅRIAS**

### **Backend (Go)**
```bash
# Obrigat√≥rias
MONGO_URI=mongodb://localhost:27017/retech
APIKEY_HASH_SECRET=9gJlYXwSR1kfAv8Dh4mHRb/WGJKpLV5v+NYDsNFWTJ8=  # ‚úÖ NOVO
JWT_ACCESS_SECRET=seu-secret-access
JWT_REFRESH_SECRET=seu-secret-refresh

# Opcionais (com fallback)
PORT=8080
ENV=production  # ou development
REDIS_URL=redis://localhost:6379  # Se n√£o tiver, usa graceful degradation
API_BASE_URL=https://core.theretech.com.br
CORS_ENABLE=true
JWT_ACCESS_TTL=900   # 15 minutos (sobrescrito por admin/settings)
JWT_REFRESH_TTL=604800  # 7 dias (sobrescrito por admin/settings)
```

### **Frontend (Next.js)**
```bash
# Obrigat√≥rias
NEXT_PUBLIC_API_URL=https://core.theretech.com.br

# Opcionais
NODE_ENV=production
```

---

## üí° **LI√á√ïES APRENDIDAS**

### **Performance**
‚úÖ **Redis √© essencial:** Reduz lat√™ncia de 160ms ‚Üí 1ms (160x)  
‚úÖ **MongoDB Indexes:** Auto-cria√ß√£o no startup evita erros  
‚úÖ **Graceful Degradation:** Sistema funciona mesmo se Redis cair  
‚úÖ **Timezone Matters:** Usar America/Sao_Paulo evita bugs de data

### **Seguran√ßa**
‚úÖ **Nunca usar fallbacks inseguros:** Panic se vari√°vel cr√≠tica n√£o existir  
‚úÖ **Ocultar secrets no frontend:** Usu√°rio n√£o precisa ver API Key completa  
‚úÖ **Scopes granulares:** Melhor que `all` ou nada  
‚úÖ **Rate limiting por camada:** IP + Tenant + Global

### **UX & DX**
‚úÖ **Feedback visual:** Usu√°rio precisa saber que a√ß√£o foi bem-sucedida  
‚úÖ **Confirma√ß√µes cr√≠ticas:** AlertDialog antes de deletar  
‚úÖ **Logs detalhados:** Console logs ajudam muito no debug  
‚úÖ **Playground p√∫blico:** Maior diferencial competitivo (convers√£o)

### **DevOps**
‚úÖ **Docker Compose:** Facilita dev e deploy  
‚úÖ **Vari√°veis de ambiente:** Separar por ambiente (.env.local, .env.production)  
‚úÖ **CI/CD:** GitHub Actions + SSH deploy  
‚úÖ **Migrations:** Auto-aplicar indexes/schemas no startup

---

## üéØ **METAS 2025-2026**

### **Q4 2025 (Out-Dez)**
- [x] Fase 1 completa (3 APIs)
- [ ] Migra√ß√£o Oracle Cloud (lat√™ncia <15ms)
- [ ] Fase 2 completa (6 APIs)
- [ ] 10.000 requests/m√™s

### **Q1 2026 (Jan-Mar)**
- [ ] Fase 3 completa (17 APIs)
- [ ] NF-e + Certid√µes implementadas
- [ ] 50.000 requests/m√™s
- [ ] 100 tenants ativos

### **Q2 2026 (Abr-Jun)**
- [ ] Fase 4 completa (7 APIs)
- [ ] Open Finance integrado (Boletos)
- [ ] 200.000 requests/m√™s
- [ ] 500 tenants ativos

### **Q3-Q4 2026 (Jul-Dez)**
- [ ] 36 APIs completas
- [ ] 1M requests/m√™s
- [ ] 2.000 tenants ativos
- [ ] Break-even financeiro

---

## üìä **KPIs DE SUCESSO**

### **Performance**
- ‚úÖ Lat√™ncia P50: <160ms (atual)
- üéØ Lat√™ncia P50: <15ms (Oracle Cloud)
- üéØ Cache Hit Rate: >80%
- ‚úÖ Uptime: 99.9%

### **Ado√ß√£o**
- ‚úÖ APIs dispon√≠veis: 3/36 (8%)
- üéØ APIs dispon√≠veis: 36/36 (100%)
- ‚úÖ Playground p√∫blico: Implementado
- üéØ Convers√£o playground: 10-15%

### **Financeiro**
- ‚úÖ Custo infraestrutura: $5-10/m√™s (Railway)
- üéØ Custo infraestrutura: R$ 0/m√™s (Oracle Free Tier)
- üéØ MRR (Monthly Recurring Revenue): R$ 5.000/m√™s (Q2 2026)

### **Qualidade**
- ‚úÖ Cobertura de testes: 0% (TODO)
- üéØ Cobertura de testes: 80%
- ‚úÖ Documenta√ß√£o: OpenAPI 3.0
- ‚úÖ Admin Dashboard: Completo

---

## üîó **LINKS IMPORTANTES**

### **Produ√ß√£o**
- **Frontend:** https://core.theretech.com.br
- **Backend API:** https://core.theretech.com.br (via Railway)
- **Docs:** https://core.theretech.com.br/docs
- **Playground:** https://core.theretech.com.br/playground

### **Reposit√≥rios**
- **Backend:** github.com/theretech/retech-core
- **Frontend:** github.com/theretech/retech-core-admin

### **Infraestrutura**
- **Railway:** dashboard.railway.app
- **Cloudflare:** dash.cloudflare.com (DNS)
- **Oracle Cloud:** cloud.oracle.com (futuro)

### **Monitoramento**
- **Railway Logs:** Via dashboard web
- **MongoDB:** Compass local (mongodb://localhost:27017)
- **Redis:** RedisInsight ou CLI

---

## ü§ù **CONTRIBUINDO**

### **Processo de Desenvolvimento**
1. Criar branch: `feature/nome-da-api`
2. Implementar handler: `internal/http/handlers/nome.go`
3. Adicionar rota: `internal/http/router.go`
4. Criar testes (TODO)
5. Atualizar documenta√ß√£o
6. PR para `main`

### **Checklist Nova API**
- [ ] Handler com cache 3 camadas (Redis + MongoDB + Externa)
- [ ] Valida√ß√£o de input
- [ ] Normaliza√ß√£o de dados
- [ ] Scope espec√≠fico (`nome`)
- [ ] Rate limiting
- [ ] Admin settings (toggle, TTL, stats, clear)
- [ ] Testes unit√°rios
- [ ] Documenta√ß√£o OpenAPI
- [ ] Landing page (`/apis/nome`)
- [ ] Adicionar no playground

---

## üìû **CONTATO & SUPORTE**

**WhatsApp:** +55 48 99961-6679  
**Email:** suporte@theretech.com.br  
**Documenta√ß√£o:** https://core.theretech.com.br/docs

---

**üöÄ ROADMAP EM CONSTANTE EVOLU√á√ÉO!**

**√öltima atualiza√ß√£o:** 27 de Outubro de 2025  
**Pr√≥xima revis√£o:** 15 de Novembro de 2025 (ap√≥s migra√ß√£o Oracle Cloud)

**Juntos, construindo o futuro das APIs brasileiras! üáßüá∑**

---

## üìã **CHECKLIST P√ìS-IMPLEMENTA√á√ÉO**

**Ap√≥s implementar uma nova funcionalidade ou API, siga esta lista para concluir a entrega:**

> üí° **Baseado na implementa√ß√£o da "Busca Reversa de CEP"**

### **üìù O Que Fazer Ap√≥s Implementar:**

1. **Atualizar Redoc (OpenAPI)**
   - Arquivo: `internal/docs/openapi.yaml`
   - Adicionar endpoint com descri√ß√£o, par√¢metros, responses e exemplos
   - **‚ö†Ô∏è Documentar tratamento de dados:**
     - Acentos: aceita ou precisa remover?
     - Case: mai√∫scula, min√∫scula ou tanto faz?
     - Encoding: autom√°tico ou dev precisa fazer?
     - Formato: com/sem tra√ßo, pontos, etc
     - Adicionar exemplos com m√∫ltiplos formatos

2. **Atualizar Documenta√ß√£o do Painel**
   - Arquivo: `internal/http/handlers/tenant.go` (fun√ß√£o `GetMyConfig`)
   - Adicionar endpoint na lista da categoria correspondente
   - Incluir emoji üÜï se for funcionalidade recente
   - Descri√ß√£o clara e objetiva (uma linha)

3. **Verificar Analytics/Logging (Autom√°tico)**
   - ‚úÖ Middleware `UsageLogger` deve estar aplicado na rota (verificar router.go)
   - ‚úÖ Logs salvam automaticamente em `api_usage_logs`
   - ‚úÖ Analytics agrupa por `apiName` (extra√≠do do primeiro segmento da URL)
   - ‚úÖ Dashboard `/admin/analytics` mostra automaticamente
   - ‚ö†Ô∏è **NADA precisa fazer** se middleware est√° aplicado!

4. **Atualizar Landing Page**
   - Arquivo: `app/page.tsx`
   - Adicionar card na se√ß√£o "APIs Dispon√≠veis" (se for API nova)
   - OU atualizar recursos do card existente (se for funcionalidade)

5. **Criar Ferramenta P√∫blica (se aplic√°vel)**
   - Criar `app/ferramentas/[nome]/page.tsx`
   - Integrar com API Key demo do playground
   - Adicionar badge "NOVO" se for recente

6. **Playground - Avaliar se Faz Sentido Adicionar**
   
   **‚ö†Ô∏è NEM TUDO vai para o playground!**
   
   **‚úÖ ADICIONAR no playground SE:**
   - Funcionalidade CORE da API
   - Input simples (1-2 campos max)
   - Desenvolvedores v√£o querer **testar o c√≥digo**
   - Gerar c√≥digo autom√°tico √© √∫til
   - Exemplo: consulta CEP por c√≥digo, busca CNPJ, listar UFs
   
   **‚ùå N√ÉO ADICIONAR no playground SE:**
   - J√° existe ferramenta dedicada funcional
   - Input muito complexo (3+ campos)
   - Foco √© usu√°rio final, n√£o desenvolvedor
   - J√° tem SEO pr√≥prio (ferramenta p√∫blica)
   - Exemplo: busca reversa CEP (3 inputs + ferramenta pr√≥pria)
   
   **üéØ Regra de ouro:**
   > "Playground √© para devs testarem e copiarem c√≥digo. Ferramenta √© para usu√°rios resolverem problemas."
   
   **üìã Exemplos de Decis√µes:**
   
   | Funcionalidade | Playground? | Ferramenta? | Motivo |
   |----------------|-------------|-------------|--------|
   | Consulta CEP por c√≥digo | ‚úÖ Sim | ‚úÖ Sim | Core + simples (1 input) |
   | Busca reversa CEP | ‚ùå N√£o | ‚úÖ Sim | 3 inputs + foco SEO |
   | Consulta CNPJ | ‚úÖ Sim | ‚úÖ Sim | Core + simples (1 input) |
   | Lista UFs | ‚úÖ Sim | ‚ùå N√£o | Sem input + √∫til para devs |
   | Cota√ß√£o moedas | ‚úÖ Sim | ‚ùå N√£o | Simples + devs precisam testar |
   | C√°lculo de frete | ‚ùå N√£o | ‚úÖ Sim | 5+ inputs + foco usu√°rio final |
   
   **üîÑ Fluxo de Decis√£o:**
   ```
   Nova funcionalidade implementada
            ‚Üì
   Quantos inputs? ‚Üí 1-2 ‚Üí P√∫blico-alvo? ‚Üí Devs ‚Üí ‚úÖ PLAYGROUND + Ferramenta
            ‚Üì                            ‚Üí Usu√°rios ‚Üí ‚úÖ Ferramenta
            ‚Üì
   Quantos inputs? ‚Üí 3+ ‚Üí ‚úÖ Apenas FERRAMENTA (n√£o playground)
   ```

7. **Atualizar ROADMAP**
   - Marcar endpoints como [x] conclu√≠do
   - Adicionar na se√ß√£o "√öltimas Atualiza√ß√µes" com data
   - ‚ö†Ô∏è Verificar se altera contador (Nova API vs Funcionalidade)

8. **Testar Tudo**
   - Backend: endpoint funcionando, cache L1/L2/L3, valida√ß√µes
   - Frontend: ferramenta p√∫blica, playground (se foi adicionado)
   - Docs: Redoc e Painel Docs mostrando endpoint
   - Analytics: fazer 2-3 requests e verificar em `/admin/analytics`
   - Mobile: responsividade

9. **Verificar Seguran√ßa**
   - API Key obrigat√≥ria
   - Scope correto aplicado
   - Rate limiting funcionando
   - Logs de usage salvando

10. **Performance**
    - Cache hit ap√≥s 2¬™ request
    - Response time adequado
    - Graceful degradation (se Redis cair)

11. **Melhorias no C√≥digo (se aplic√°vel)**
    - URL Encoding: usar `url.PathEscape()` ou `url.QueryEscape()` para par√¢metros
    - Valida√ß√£o: normalizar entrada antes de processar
    - Tratamento: aceitar diferentes formatos (com/sem acentos, formata√ß√£o, etc)

12. **Configurar Cache (se for API nova)**
    - Arquivo: `internal/domain/settings.go`
    - Adicionar `ServiceCacheConfig` para a nova API no struct `CacheConfig`
    - Definir TTL padr√£o apropriado (ex: 7 dias, 30 dias, 365 dias)
    - Definir `AutoCleanup` (true para dados din√¢micos, false para est√°ticos)
    - Adicionar defaults em `GetDefaultSettings()`

13. **Adicionar Scopes (se for API nova)**
    - Arquivo: `internal/auth/scope_middleware.go`
    - Adicionar scope no map `validScopes` (ex: `"phone": true`)
    - Aplicar scope nas rotas em `router.go` via `auth.RequireScope()`
    - Atualizar `AllowedAPIs` no playground config se aplic√°vel

14. **Atualizar Sitemap (se aplic√°vel)**
    - Arquivo: `app/sitemap.ts`
    - Adicionar nova ferramenta p√∫blica
    - Adicionar novas p√°ginas criadas
    - Verificar prioridades (0.1-1.0)
    - ‚ö†Ô∏è N√£o esquecer redirects (ex: `/termos` ‚Üí `/legal/termos`)

15. **Verificar SEO (P√≥s-Deploy)**
    - **T√≠tulos √∫nicos:** Cada p√°gina deve ter title diferente
      - Criar `layout.tsx` em cada pasta se necess√°rio
      - Formato: `[Fun√ß√£o] - [Se√ß√£o] | Retech Core`
      - Ex: `Login - Portal do Desenvolvedor | Retech Core API`
    - **Meta descriptions √∫nicas:** Cada p√°gina deve ter description espec√≠fica
      - Descrever o prop√≥sito exato da p√°gina
      - Incluir keywords relevantes
    - **Verificar 404s:**
      - Testar todos os links internos
      - Criar redirects se necess√°rio (`/termos` ‚Üí `/legal/termos`)
    - **Robots.txt:** Verificar se permite crawling
    - **Sitemap:** Verificar se todas as p√°ginas p√∫blicas est√£o inclu√≠das
    - **Ferramenta:** Usar Google Search Console ou Ahrefs Site Audit

16. **Commit e Deploy**
    - Build sem erros (Go + Next.js)
    - Commit com mensagem clara
    - Deploy (Railway auto-deploy)
    - Smoke test em produ√ß√£o

---

### **üì¶ Arquivos Comuns a Modificar:**

**Backend:**
- `internal/http/handlers/[nome].go` - Handler principal
- `internal/http/handlers/tenant.go` - GetMyConfig (docs do painel)
- `internal/http/router.go` - Rotas (public + protected + admin)
- `internal/domain/settings.go` - CacheConfig (se precisar)
- `internal/bootstrap/indexes.go` - Indexes MongoDB (se precisar)

**Frontend:**
- `app/page.tsx` - Landing page (card da API)
- `app/ferramentas/[nome]/page.tsx` - Ferramenta p√∫blica (novo)
- `app/painel/docs/page.tsx` - Painel do dev (adicionar dicas se necess√°rio)
- `app/playground/page.tsx` - Playground (se aplic√°vel)
- `app/admin/settings/page.tsx` - Admin settings (se precisar)

**Documenta√ß√£o:**
- `internal/docs/openapi.yaml` - Redoc
- `docs/Planning/ROADMAP.md` - Este arquivo

---

### **üìù Exemplo Real - Busca Reversa de CEP:**

**Backend (3 arquivos modificados):**
- `internal/http/handlers/cep.go` (+255 linhas - handler + url.PathEscape)
- `internal/http/handlers/tenant.go` (+6 linhas - docs painel)
- `internal/http/router.go` (+12 linhas - rotas)

**Frontend (8 arquivos, 6 novos):**
- üÜï `app/ferramentas/buscar-cep/layout.tsx` (novo)
- üÜï `app/ferramentas/buscar-cep/page.tsx` (novo, 250 linhas)
- üÜï `app/painel/recuperar-senha/page.tsx` (novo, 120 linhas)
- üÜï `app/admin/recuperar-senha/page.tsx` (novo, 120 linhas)
- üÜï `app/privacidade/page.tsx` (redirect)
- üÜï `app/termos/page.tsx` (redirect)
- ‚úèÔ∏è `app/page.tsx` (+95 linhas - card novo)
- ‚úèÔ∏è `app/painel/docs/page.tsx` (+52 linhas - dicas de formata√ß√£o)
- ‚úèÔ∏è `app/sitemap.ts` (+50 linhas - novas p√°ginas)

**Documenta√ß√£o (2 arquivos):**
- ‚úèÔ∏è `internal/docs/openapi.yaml` (+220 linhas - com dicas de encoding)
- ‚úèÔ∏è `docs/Planning/ROADMAP.md` (+200 linhas - checklist + boas pr√°ticas)

**Outros:**
- üÜï `public/llms.txt` (novo - para LLMs)

**Total:** 14 arquivos | ~1.300 linhas | ~7 horas ‚è±Ô∏è

---

### **‚ö†Ô∏è IMPORTANTE - Nova API vs Funcionalidade:**

**Determinar se altera contador da landing page (9/36 APIs):**

‚úÖ **NOVA API** (atualizar contador):
- Servi√ßo completamente novo
- Fonte de dados distinta
- Scope pr√≥prio

‚ùå **FUNCIONALIDADE** (n√£o altera contador):
- Novo endpoint em API existente
- Mesma fonte de dados
- Mesmo scope

**Exemplo:** Busca reversa CEP = Funcionalidade (n√£o altera 9/36)

---

### **üîó Arquivos de Refer√™ncia:**
- Handler: `internal/http/handlers/cep.go` (linha 274)
- Router: `internal/http/router.go` (linhas 156-162, 229)
- Tenant: `internal/http/handlers/tenant.go` (linha 371-376)
- OpenAPI: `internal/docs/openapi.yaml` (linhas 196-377)
- Ferramenta: `app/ferramentas/buscar-cep/page.tsx`
- Landing: `app/page.tsx` (linhas 399-425)
- UsageLogger: `internal/middleware/usage_logger.go` (extrai apiName automaticamente)

---

### **üìä Como Verificar se Analytics Est√° Funcionando:**

1. **Fazer algumas requests** para o novo endpoint:
```bash
   curl "http://localhost:8080/cep/buscar?uf=SP&cidade=Sao+Paulo&logradouro=Paulista" \
     -H "X-API-Key: sua_api_key"
   ```

2. **Acessar dashboard admin:**
   ```
   http://localhost:3002/admin/analytics
   ```

3. **Verificar:**
   - ‚úÖ Total de requests aumentou
   - ‚úÖ API "CEP" aparece com mais requests
   - ‚úÖ Endpoint `/cep/buscar` aparece no "Top Endpoints"
   - ‚úÖ Response time est√° sendo medido

4. **‚ö†Ô∏è Nota importante:**
   - `/cep/buscar` e `/cep/:codigo` s√£o contados juntos como API "cep"
   - Mas aparecem separados em "Top Endpoints"
   - Isso √© o comportamento esperado!

5. **O que voc√™ ver√° no analytics:**
   ```
   üìä Breakdown por API:
   - CEP: 150 requests (inclui /cep/:codigo + /cep/buscar)
   - CNPJ: 80 requests
   - Geografia: 45 requests
   
   üìà Top Endpoints:
   - /cep/:codigo - 95 requests
   - /cep/buscar - 55 requests  ‚Üê NOVO!
   - /cnpj/:numero - 80 requests
```

---

### **üìù Boas Pr√°ticas de Documenta√ß√£o:**

**Sempre documente para o desenvolvedor:**

1. **Tratamento de Acentos:**
   ```yaml
   description: |
     **‚úÖ Aceita acentos:** "S√£o Paulo", "Jo√£o Pessoa"
     - Com acentos: cidade=S√£o Paulo (recomendado)
     - Sem acentos: cidade=Sao Paulo (funciona, menos preciso)
   ```

2. **Case Sensitivity:**
   ```yaml
   description: |
     **Case:** Mai√∫sculas/min√∫sculas n√£o importam
     - ‚úÖ "s√£o paulo" = "S√£o Paulo" = "S√ÉO PAULO"
     - ‚ö†Ô∏è UF deve ser MAI√öSCULO: "SP" (n√£o "sp")
   ```

3. **Formato de Entrada:**
   ```yaml
   description: |
     **Formato aceito:**
     - Com formata√ß√£o: 00.000.000/0001-91
     - Sem formata√ß√£o: 00000000000191
     - Ambos funcionam! A API normaliza automaticamente.
   ```

4. **Encoding:**
   ```yaml
   description: |
     **Encoding:** Autom√°tico pelo backend
     - Espa√ßos: use + ou %20
     - Acentos: enviados diretamente
     - Caracteres especiais: URL encoded automaticamente
   ```

5. **Exemplos Pr√°ticos:**
   - Sempre incluir 2-3 exemplos com diferentes formatos
   - Mostrar caso t√≠pico + caso com acentos + caso URL encoded
   - Indicar qual √© recomendado (‚≠ê)

**Exemplo Completo (Busca Reversa CEP):**
- ‚úÖ 3 exemplos de cURL (com acentos, sem acentos, encoded)
- ‚úÖ Dicas de formata√ß√£o (acentos, espa√ßos, case)
- ‚úÖ Indica√ß√£o de recomendado
- ‚úÖ Avisos sobre precis√£o

---


## ‚ö†Ô∏è **CRIT√âRIO DE CONTAGEM: NOVA API vs FUNCIONALIDADE**

**Use este guia para decidir se atualiza o contador da landing page:**

### **‚úÖ CONTA como "NOVA API" (atualizar 9/36 ‚Üí 10/36):**
1. **Servi√ßo completamente novo** com fonte de dados distinta
2. **Scope pr√≥prio** (novo escopo de permiss√£o)
3. **Dom√≠nio diferente** (ex: ap√≥s CEP/CNPJ, adicionar Moedas)
4. **Collection MongoDB separada** para cache principal
5. **Documenta√ß√£o independente** no Redoc

**Exemplos:**
- ‚úÖ CPF (ap√≥s ter CEP/CNPJ)
- ‚úÖ Moedas (ap√≥s ter CEP/CNPJ/Geografia)
- ‚úÖ FIPE (ap√≥s ter Moedas)
- ‚úÖ Feriados (ap√≥s ter FIPE)

### **‚ùå N√ÉO CONTA como nova API (manter 9/36):**
1. **Novo endpoint** na mesma API
2. **Varia√ß√£o de busca** (ex: busca reversa)
3. **Filtro adicional** em API existente
4. **Formato alternativo** de resposta
5. **Mesmo dom√≠nio** e scope

**Exemplos:**
- ‚ùå Busca reversa CEP (j√° temos CEP)
- ‚ùå CNPJ por nome fantasia (j√° temos CNPJ)
- ‚ùå Geografia com filtro adicional (j√° temos Geografia)
- ‚ùå CEP com coordenadas (j√° temos CEP)

### **üìä Impacto na Landing Page:**

**Se for NOVA API:**
```
Antes: 25% (9/36 APIs)
Depois: 27% (10/36 APIs)
```

**Se for FUNCIONALIDADE:**
```
Antes: 25% (9/36 APIs)
Depois: 25% (9/36 APIs) ‚Üê N√ÉO MUDA!
```

**O que atualizar quando for FUNCIONALIDADE:**
- ‚úÖ Se√ß√£o da API no ROADMAP (adicionar novo endpoint)
- ‚úÖ Card da API na landing (adicionar recurso)
- ‚úÖ Documenta√ß√£o Redoc (novo path)
- ‚úÖ √öltima atualiza√ß√£o no ROADMAP
- ‚ùå Contador de APIs (mant√©m igual!)
- ‚ùå Barra de progresso (mant√©m igual!)

### **üéØ Regra de Ouro:**

> **"Se usa o mesmo scope e mesma fonte de dados, √© FUNCIONALIDADE, n√£o API nova!"**

**Em caso de d√∫vida:**
- Pergunte: "Um desenvolvedor precisaria de 2 API Keys diferentes?"
- Se N√ÉO ‚Üí √â funcionalidade
- Se SIM ‚Üí √â API nova

---



**‚úÖ CHECKLIST SIMPLIFICADO PRONTO PARA USO!**

---

**√öltima atualiza√ß√£o:** 28 de Outubro de 2025  
**Pr√≥xima revis√£o:** 15 de Novembro de 2025

**Juntos, construindo o futuro das APIs brasileiras! üáßüá∑**
